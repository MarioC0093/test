<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="es" xml:lang="es"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Máster de Bioestadística - Probabilidad y Simulación</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../tema_02/tema_02_3_curvas_roc.html" rel="next">
<link href="../tema_02/tema_02_2_comparacion_test_y_tamanyos_muestrales.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "Sin resultados",
    "search-matching-documents-text": "documentos encontrados",
    "search-copy-link-title": "Copiar el enlace en la búsqueda",
    "search-hide-matches-text": "Ocultar resultados adicionales",
    "search-more-match-text": "resultado adicional en este documento",
    "search-more-matches-text": "resultados adicionales en este documento",
    "search-clear-button-title": "Borrar",
    "search-detached-cancel-button-title": "Cancelar",
    "search-submit-button-title": "Enviar",
    "search-label": "Buscar"
  }
}</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><link rel="stylesheet" href="../css/styles.css">
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../tema_02/tema_02.html">TEMA 2</a></li><li class="breadcrumb-item"><a href="../tema_02/tema_2_28_11_2024.html"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">tema_2_28_11_2024</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Buscar"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Introducción</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../DUDAS.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Dudas</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../tema_00/tema_00.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">TEMA 0</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Alternar sección">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tema_00/tema_00_introduccion.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Introducción</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../tema_01/tema_01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">TEMA 1</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Alternar sección">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tema_01/tema_01_1_introduccion.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">1. Introducción <span style="color:green;">✓</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tema_01/tema_01_2_concordancia_categoricas.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">2. Análisis de concordancia en variables categóricas <span style="color:green;">✓</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tema_01/tema_01_3_concordancia_numericas.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">3. Análisis de concordancia en variables numéricas <span style="color:green;">✓</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tema_01/tema_01_4_tamanyo_muestral.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">4. Cálculo del tamaño muestral <span style="color:green;">✓</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../tema_02/tema_02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">TEMA 2</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Alternar sección">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tema_02/tema_02_1_introduccion.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">1.1. Conceptos básicos <span style="color:green;">✓</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tema_02/tema_02_1_2_cohortes_y_casos_control.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">1.2 Estudios de cohorte y casos-control <span style="color:green;">✓</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tema_02/tema_02_2_comparacion_test_y_tamanyos_muestrales.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">2. Comparación de test y tratamiento del tamaño mmuestral <span style="color:red;">✗</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tema_02/tema_2_28_11_2024.html" class="sidebar-item-text sidebar-link active"><span class="chapter-title">tema_2_28_11_2024</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tema_02/tema_02_3_curvas_roc.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">3. Validación de biomarcadores. Curvas ROC <span style="color:red;">✗</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tema_02/tema_02_3_curvas_roc_final.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">curvas ROC - segunda parte</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../tema_03/tema_03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">TEMA 3</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Alternar sección">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tema_03/tema_03_1_introduccion.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">1. Introducción <span style="color:green;">✓</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tema_03/tema_03_2_selección_aleatoria.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">2. Selección aleatoria de pacientes y asignación de tratamientos <span style="color:red;">✗</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tema_03/tema_03_3_obtener_datos_simulados.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">3. Obtener datos simulados a partir de observaciones reales <span style="color:green;">✓</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tema_03/tema_03_4_remuestreo_inferencia_roc.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">4. Técnicas de remuestreo aplicadas a la inferencia de curvas ROC <span style="color:red;">✗</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="99"><h2 id="toc-title">In this page</h2>
   
  <ul>
<li>
<a href="#estimaci%C3%B3n-no-param%C3%A9trica-de-curvas-roc" id="toc-estimación-no-paramétrica-de-curvas-roc" class="nav-link active" data-scroll-target="#estimaci%C3%B3n-no-param%C3%A9trica-de-curvas-roc">Estimación no paramétrica de curvas ROC</a>
  <ul>
<li><a href="#m%C3%A9todoemp%C3%ADrico" id="toc-métodoempírico" class="nav-link" data-scroll-target="#m%C3%A9todoemp%C3%ADrico">Métodoempírico</a></li>
  <li><a href="#suavizado-tipo-n%C3%BAcleo" id="toc-suavizado-tipo-núcleo" class="nav-link" data-scroll-target="#suavizado-tipo-n%C3%BAcleo">Suavizado tipo núcleo</a></li>
  </ul>
</li>
  <li>
<a href="#intervalos-y-bandas-de-confianza" id="toc-intervalos-y-bandas-de-confianza" class="nav-link" data-scroll-target="#intervalos-y-bandas-de-confianza">Intervalos y bandas de confianza</a>
  <ul>
<li><a href="#comparaci%C3%B3n-de-curvas-roc" id="toc-comparación-de-curvas-roc" class="nav-link" data-scroll-target="#comparaci%C3%B3n-de-curvas-roc">Comparación de curvas ROC</a></li>
  <li><a href="#elecci%C3%B3n-del-punto-de-corte-c" id="toc-elección-del-punto-de-corte-c" class="nav-link" data-scroll-target="#elecci%C3%B3n-del-punto-de-corte-c">Elección del punto de corte c</a></li>
  </ul>
</li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title"><span class="chapter-title">tema_2_28_11_2024</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><p><u><strong>Ejemplo 2.5.</strong></u></p>
<p><span class="math inline">\(D = enfermo\)</span> <span class="math inline">\(Y_{\over{D}} ~ N(7.5,0.2)\)</span> <span class="math inline">\(Y_{D} ~ N(8.5,0.6)\)</span></p>
<p><span class="math display">\[
ROC(t) = \Phi\left( \frac{\mu_D - \mu_{\overline{D}}}{\sigma_D} + \frac{\sigma_{\overline{D}}}{\sigma_D} \Phi^{-1}(t) \right)
\]</span></p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ROC</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">mu_D</span>, <span class="va">mu_D_bar</span>, <span class="va">sigma_D</span>, <span class="va">sigma_D_bar</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># pnorm( (mu_D - mu_D_bar) / sigma_D + (sigma_D_bar / sigma_D) * qnorm(t) )</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">pnorm</a></span><span class="op">(</span> <span class="op">(</span><span class="va">mu_D</span> <span class="op">-</span> <span class="va">mu_D_bar</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">sigma_D_bar</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="va">sigma_D</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Ejemplo de uso con valores específicos</span></span>
<span><span class="va">t</span> <span class="op">&lt;-</span> <span class="fl">0.5</span>           <span class="co"># Valor del percentil</span></span>
<span><span class="va">mu_D</span> <span class="op">&lt;-</span> <span class="fl">8.5</span>          <span class="co"># Media de D</span></span>
<span><span class="va">mu_D_bar</span> <span class="op">&lt;-</span> <span class="fl">7.5</span>    <span class="co"># Media de D_bar</span></span>
<span><span class="va">sigma_D</span> <span class="op">&lt;-</span> <span class="fl">0.6</span>     <span class="co"># Desviación estándar de D</span></span>
<span><span class="va">sigma_D_bar</span> <span class="op">&lt;-</span> <span class="fl">0.2</span> <span class="co"># Desviación estándar de D_bar</span></span>
<span></span>
<span><span class="va">ROC_value</span> <span class="op">&lt;-</span> <span class="fu">ROC</span><span class="op">(</span><span class="va">t</span>, <span class="va">mu_D</span>, <span class="va">mu_D_bar</span>, <span class="va">sigma_D</span>, <span class="va">sigma_D_bar</span><span class="op">)</span></span>
<span><span class="va">ROC_value</span></span>
<span><span class="co">## [1] 0.9430769</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><span class="math inline">\(AUC = \Phi\left( \frac{8.5 - 7.5}{\sqrt{0.6^2 + 0.02^2}} \right) = \Phi(Z &lt; 1.58) = 0.9521\)</span></p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">AUC</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">pnorm</a></span><span class="op">(</span> <span class="op">(</span><span class="fl">8.5</span> <span class="op">-</span> <span class="fl">7.5</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fl">0.6</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="fl">0.02</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## [1] 0.9521175</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Es el area bajo la curva, no una estimacion.</p>
<p>Con el metodo binomal, siempre que tenemos información acerca de las respuestas de los dos grupos no tenemos una estimación del AUC, sino el AUC.</p>
<p>En el momento en que tenos que usar información adicional o estimar valores pasamos a tener una estimación del AUC.</p>
<p>En este caso al ser un dato exacto y no estimado no tenemos IC.</p>
<p><strong>Interpretación.</strong> Eligiendo dos valores (uno de cada muestra) y asignando el valor más alto a los enfermo (por defecto los valores más altos se asignas como los casos) entonces la probabilidad de acierto es el area bajo la curva.</p>
<p><strong>Un AUC estimado también tiene la misma interpretación que el AUC.</strong></p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">7.5</span>, <span class="fl">0.2</span><span class="op">)</span></span>
<span><span class="co">## [1] 7.36778</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">8.5</span>, <span class="fl">0.6</span><span class="op">)</span></span>
<span><span class="co">## [1] 7.573254</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Si tengo estos dos valores y asigno el primero a un no cirrótio y el segundo a un sí cirrot, mi prob de acercar es 0.4.</p>
<p>elijo dos valores (uno en cada muestra) y asigno el valor mas alto a los enfermo (por defecto los valores mas altos para los casos) entonces la prob de acierto es el area bajo la curva</p>
<section id="estimación-no-paramétrica-de-curvas-roc" class="level2"><h2 class="anchored" data-anchor-id="estimación-no-paramétrica-de-curvas-roc">Estimación no paramétrica de curvas ROC</h2>
<p>Se trata de casos donde solo tenemos información muestral: una muestra de resultados para los casos sanos y otra muestra de resultados para los casos enfermos.</p>
<section id="métodoempírico" class="level3"><h3 class="anchored" data-anchor-id="métodoempírico">Métodoempírico</h3>
<p>Es el método no paramétrico más usado tradicionalmente para pruebas diagnósticas continuas y se basa en las distribuciones empíricas de las muestras de sanos y enfermos.</p>
<p>Para cada una de las muestras miro la proporción de casos que se encuentran por encima del punto de corte.</p>
<p>En casos donde la variable respuesta es un biomarcador con unidades de medida, muchas veces la <strong>máquina correspondiente</strong> da pocos decimales o incluso ninguno. En esta situación estamos chocando con la hipótesis de que es imposible que dos individuos tengan el mismo valor para una variable continua. (esto se refleja en la curva ROC y ya veremos cómo impacta)</p>
<p>Sea <span class="math inline">\(\{Y_{D_i}, i = 1, \dots, n_D\} \; \text{m.a.s.} \; Y_D \; m.a.s Y_D\)</span> y sea <span class="math inline">\(\{Y_\overline{D_i}, i = 1, \dots, n_\overline{D_i}\} \; \text{m.a.s.} \; Y_\overline{D}\)</span>.</p>
<p>Para cada punto de corte <em>c</em> estimamos: <span class="math display">\[\hat{\text{Se}}(c) = \frac{1}{n_D} \sum_{i=1}^{n_D} I\{Y_{D_i} \geq c\} = \frac{\# I\{Y_{D_i} \geq c\}}{n_D}\]</span></p>
<p><span class="math display">\[1 - \hat{\text{Sp}}(c) = \frac{1}{\bar{n}_D} \sum_{i=1}^{\bar{n}_D} I\{Y_{\bar{D}_i} \geq c\} = \frac{\# I\{Y_{\bar{D}_i} \geq c\}}{\bar{n}_D}\]</span></p>
<p><u><strong>Ejemplo. (análogo al 2.6. así que ese no le incluyo.</strong></u></p>
<p>Supongamos que queremos estimar con el método empiricio la curva ROC asociada a un biomarcador y que se ha observado la siguiente muestra de resultados del biomarcador en sanos y enfermos.</p>
<p><span class="math inline">\(Y_{\overline{D}} = (1, 1, 2, 4, 4)\)</span><br><span class="math inline">\(Y_{D} = (2, 3, 4, 5, 7)\)</span></p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">Y_overD</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">Y_D</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">6</span>, <span class="fl">7</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Los valores observados se encuentran entre 2 y 7. <strong>Asigno c € (0.5, 7.5).</strong></p>
<p><span class="math inline">\(1 - \hat{Sp}(7.5) = \text{"proporcion de individuos sanos que tienen valores por encima de c = 7.5"} = 0\)</span></p>
<p><span class="math inline">\(1 - \hat{Sp}(7.5) = \text{"proporcion de individuos enfermos que tienen valores por encima de c = 7.5"} = 0\)</span></p>
<p>Sea <span class="math inline">\(c=6\)</span> el umbral de positivos,</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># sensibilidad</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">Y_D</span> <span class="op">&gt;=</span> <span class="fl">6</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">Y_D</span><span class="op">)</span></span>
<span><span class="co">## [1] 0.4</span></span>
<span><span class="co"># especificidad</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">Y_overD</span> <span class="op">&lt;</span> <span class="fl">6</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">Y_overD</span><span class="op">)</span></span>
<span><span class="co">## [1] 1</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>c<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/double.html">double</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                 `1-Sp`<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/double.html">double</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>                 Se<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/double.html">double</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">c</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">7.5</span>, <span class="fl">0.5</span>, by<span class="op">=</span><span class="op">-</span><span class="fl">0.5</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">se</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">Y_D</span> <span class="op">&gt;</span> <span class="va">c</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">Y_D</span><span class="op">)</span></span>
<span>  <span class="va">sp</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">Y_overD</span> <span class="op">&lt;</span> <span class="va">c</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">Y_overD</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">df</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">c</span>,<span class="va">sp</span>,<span class="va">se</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'c'</span>, <span class="st">'1-Sp(c)^'</span>, <span class="st">'Se(c)^'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">`1-Sp(c)^`</span>, y <span class="op">=</span> <span class="va">`Se(c)^`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"red"</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"red"</span>, size <span class="op">=</span> <span class="fl">1</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># Agrega líneas para unir los puntos</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_abline</a></span><span class="op">(</span>intercept <span class="op">=</span> <span class="fl">0</span>, slope <span class="op">=</span> <span class="fl">1</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"gray"</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_fixed</a></span><span class="op">(</span>ratio <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"ESTIMACIÓN DE LA CURVA ROC"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"1 - Especificidad (Tasa de Falsos Positivos)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Sensibilidad (Tasa de Verdaderos Positivos)"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="tema_2_28_11_2024_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Ordenada la muestra de mayor a menor, tenemos saltos horizontales de longitud proporcional a la inversa del tamaño muestral de sanos y saltos verticales de longitud proporcional a la inversa del tamaño muestral de enfermos.</p>
<p><strong>¿Dónde la distancia vertical es máxima?</strong> En (0, 2/5) <span class="math inline">\(\rightarrow\)</span> Esto es la estiamcion del índice de Youden.</p>
<p>¿a qué corresponde esa poligonal? a los empates. ¿eing?</p>
<p>Si miras la teoria que hay detras de todo esto pues ves que esas cosas dependen de los empates.</p>
<p>el AUC estimado es 0.78, sacado a mano sumando el área de los polígonos del dibujo.</p>
<p>¿Los valores observados están en algún sitio en la curva? Nop, la curva no representa los valores (si en lugar de números hubieran sido letras ordenadas alfabéticamente hubiera sido el mismo resultado). <strong>Solo es necesario saber el orden de los valores y saber si los valores se repiten.</strong> Ni los valores ni el punto del corte a partir del cual decimos que está enfermo se ven reflejados en la curva ROC.</p>
<p><strong>La curva ROC nos refleja a nivel global cómo se comporta el biomarcador pero no indica nada sobre si discrimina bien o no. Para ver si discrimina bien o no se tiene que mirar el AUC.</strong> (cuanto más cercano a 1 mejor sirve para discriminar)</p>
<p><span class="math display">\[
\widehat{\text{ROC}}(\cdot) = \left\{ (1 - \widehat{\text{Sp}}(c), \widehat{\text{Se}}(c)), \, \forall c \in (-\infty, +\infty) \right\} = \left\{ (t, \widehat{\text{ROC}}(t)), \, t \in (0,1) \right\},
\]</span></p>
<p><span class="math display">\[
\widehat{\text{ROC}}(t) = \widehat{S}_D \left( \widehat{S}_{\bar{D}}^{-1}(t) \right),
\]</span></p>
<p>Donde <span class="math inline">\(\widehat{S}_D\)</span> y <span class="math inline">\(\widehat{S}_{\bar{D}}\)</span> son las funciones de supervivencia empíricas.</p>
<p>La curva ROC empírica es una función escalonada creciente que se aproxima a la curva ROC teórica.</p>
<p><u><strong>Índices o medidas resumen.</strong></u></p>
<p><span class="math inline">\(\widehat{\text{AUC}} = \int_0^1 \widehat{\text{ROC}}(t) \, dt = \frac{1}{n_D \bar{n}_D} \sum_{j=1}^{\bar{n}_D} \sum_{i=1}^{n_D} \left\{ I[Y_{D_i} &gt; Y_{\bar{D}_j}] + \frac{1}{2} I[Y_{D_i} = Y_{\bar{D}_j}] \right\}\)</span></p>
<p><span class="math inline">\(\widehat{pAUC}(t_0) = \int_0^{t_0} \widehat{\text{ROC}}(t) \, dt\)</span></p>
<p><span class="math inline">\(\widehat{YI} = \max \left| \widehat{ROC}(t) - t \right| = \max \left| \widehat{Se} + \widehat{\text{Sp}} - 1 \right|\)</span></p>
<p><u><strong>Ejemplo.</strong></u></p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">602</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">Ysan3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html">rgamma</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">10</span>, <span class="fl">3</span><span class="op">)</span>, digits<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">Yenf3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html">rgamma</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">12</span>, <span class="fl">3</span><span class="op">)</span>, digits<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">roc3</span> <span class="op">&lt;-</span> <span class="fu">pROC</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pROC/man/roc.html">roc</a></span><span class="op">(</span>controls <span class="op">=</span> <span class="va">Ysan3</span>, cases <span class="op">=</span> <span class="va">Yenf3</span>, partial.auc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">roc3</span> <span class="co"># pos se supone que debería dar 0.686</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
roc.default(controls = Ysan3, cases = Yenf3, partial.auc = c(0,     0.2))

Data: 100 controls &lt; 100 cases.
Partial area under the curve (specificity 0.2-0): 0.197</code></pre>
</div>
</div>
<p>Cambiando la semilla, AKA cambiando la muestra, las estimaciones de AUC cambian. Aumentando el tamaño muestral obvio que también.</p>
<p><u><strong>Ejemplo 2.7.</strong></u></p>
<p>Se disponen de datos sobre las intensidades relativas de la expresión de un determinado gen para una muestra de 23 tejidos de ovarios sanos y para 30 de tejidos con tumor .</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span> <span class="op">(</span><span class="va"><a href="https://xrobin.github.io/pROC/">pROC</a></span><span class="op">)</span></span>
<span><span class="va">cancer</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"~/Master_Bioestadistica/Simulacion/tema_02/EjemploROCcancer.csv"</span>, header<span class="op">=</span><span class="cn">TRUE</span>, sep<span class="op">=</span><span class="st">";"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">roc1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pROC/man/roc.html">roc</a></span><span class="op">(</span><span class="va">cancer</span><span class="op">$</span><span class="va">var2</span>,<span class="va">cancer</span><span class="op">$</span><span class="va">var1</span>,plot<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="tema_2_28_11_2024_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">roc1</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 15
 $ percent           : logi FALSE
 $ sensitivities     : num [1:46] 1 1 1 1 0.967 ...
 $ specificities     : num [1:46] 0 0.0435 0.087 0.1304 0.1304 ...
 $ thresholds        : num [1:46] -Inf 0.471 0.505 0.526 0.555 ...
 $ direction         : chr "&lt;"
 $ cases             : num [1:30] 0.543 0.571 0.602 0.609 0.628 0.641 0.666 0.694 0.769 0.8 ...
 $ controls          : num [1:23] 0.442 0.5 0.51 0.568 0.571 0.574 0.588 0.595 0.595 0.595 ...
 $ fun.sesp          :function (thresholds, controls, cases, direction)  
 $ auc               : 'auc' num 0.809
  ..- attr(*, "partial.auc")= logi FALSE
  ..- attr(*, "percent")= logi FALSE
  ..- attr(*, "roc")=List of 15
  .. ..$ percent           : logi FALSE
  .. ..$ sensitivities     : num [1:46] 1 1 1 1 0.967 ...
  .. ..$ specificities     : num [1:46] 0 0.0435 0.087 0.1304 0.1304 ...
  .. ..$ thresholds        : num [1:46] -Inf 0.471 0.505 0.526 0.555 ...
  .. ..$ direction         : chr "&lt;"
  .. ..$ cases             : num [1:30] 0.543 0.571 0.602 0.609 0.628 0.641 0.666 0.694 0.769 0.8 ...
  .. ..$ controls          : num [1:23] 0.442 0.5 0.51 0.568 0.571 0.574 0.588 0.595 0.595 0.595 ...
  .. ..$ fun.sesp          :function (thresholds, controls, cases, direction)  
  .. ..$ auc               : 'auc' num 0.809
  .. .. ..- attr(*, "partial.auc")= logi FALSE
  .. .. ..- attr(*, "percent")= logi FALSE
  .. .. ..- attr(*, "roc")=List of 8
  .. .. .. ..$ percent      : logi FALSE
  .. .. .. ..$ sensitivities: num [1:46] 1 1 1 1 0.967 ...
  .. .. .. ..$ specificities: num [1:46] 0 0.0435 0.087 0.1304 0.1304 ...
  .. .. .. ..$ thresholds   : num [1:46] -Inf 0.471 0.505 0.526 0.555 ...
  .. .. .. ..$ direction    : chr "&lt;"
  .. .. .. ..$ cases        : num [1:30] 0.543 0.571 0.602 0.609 0.628 0.641 0.666 0.694 0.769 0.8 ...
  .. .. .. ..$ controls     : num [1:23] 0.442 0.5 0.51 0.568 0.571 0.574 0.588 0.595 0.595 0.595 ...
  .. .. .. ..$ fun.sesp     :function (thresholds, controls, cases, direction)  
  .. .. .. ..- attr(*, "class")= chr "roc"
  .. ..$ call              : language roc.default(response = cancer$var2, predictor = cancer$var1, plot = TRUE)
  .. ..$ original.predictor: num [1:53] 0.442 0.5 0.51 0.568 0.571 0.574 0.588 0.595 0.595 0.595 ...
  .. ..$ original.response : int [1:53] 0 0 0 0 0 0 0 0 0 0 ...
  .. ..$ predictor         : num [1:53] 0.442 0.5 0.51 0.568 0.571 0.574 0.588 0.595 0.595 0.595 ...
  .. ..$ response          : int [1:53] 0 0 0 0 0 0 0 0 0 0 ...
  .. ..$ levels            : chr [1:2] "0" "1"
  .. ..- attr(*, "class")= chr "roc"
 $ call              : language roc.default(response = cancer$var2, predictor = cancer$var1, plot = TRUE)
 $ original.predictor: num [1:53] 0.442 0.5 0.51 0.568 0.571 0.574 0.588 0.595 0.595 0.595 ...
 $ original.response : int [1:53] 0 0 0 0 0 0 0 0 0 0 ...
 $ predictor         : num [1:53] 0.442 0.5 0.51 0.568 0.571 0.574 0.588 0.595 0.595 0.595 ...
 $ response          : int [1:53] 0 0 0 0 0 0 0 0 0 0 ...
 $ levels            : chr [1:2] "0" "1"
 - attr(*, "class")= chr "roc"</code></pre>
</div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">Youden</span> <span class="op">&lt;-</span> <span class="va">roc1</span><span class="op">$</span><span class="va">sensitivities</span><span class="op">+</span><span class="va">roc1</span><span class="op">$</span><span class="va">specificities</span><span class="op">-</span><span class="fl">1</span></span>
<span><span class="va">Youden</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">Youden</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">Youden</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.0000  0.1431  0.3297  0.2977  0.4453  0.5696 </code></pre>
</div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">YI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">Youden</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/pROC/man/plot.roc.html">plot.roc</a></span><span class="op">(</span><span class="va">roc1</span>,print.auc <span class="op">=</span> <span class="cn">TRUE</span>, legacy.axes <span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="tema_2_28_11_2024_files/figure-html/unnamed-chunk-9-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><u><strong>Ejemplo 2.8.</strong></u></p>
<p>¿Es el porcentaje de protombina un buen marcador de cirrosis? Los datos disponibles corresponden a una muestra de 145 individuos sanos y 39 cirróticos.</p>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span> <span class="op">(</span><span class="va"><a href="https://xrobin.github.io/pROC/">pROC</a></span><span class="op">)</span></span>
<span><span class="va">cirroticos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"~/Master_Bioestadistica/Simulacion/tema_02/Protom_SanCirr.csv"</span>, header<span class="op">=</span><span class="cn">TRUE</span>, sep<span class="op">=</span><span class="st">";"</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Representamos histogramas y distribuciones de densidad de los datos muestrales para hacernos una idea de si vamos a tener un biomarcador que nos ayude a discriminar o no.</p>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">densidad_cirroticos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/density.html">density</a></span><span class="op">(</span><span class="va">cirroticos</span><span class="op">$</span><span class="va">X.protombina</span><span class="op">[</span><span class="va">cirroticos</span><span class="op">$</span><span class="va">cirroticos.sanos</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">densidad_sanos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/density.html">density</a></span><span class="op">(</span><span class="va">cirroticos</span><span class="op">$</span><span class="va">X.protombina</span><span class="op">[</span><span class="va">cirroticos</span><span class="op">$</span><span class="va">cirroticos.sanos</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">densidad_cirroticos</span>, </span>
<span>     main <span class="op">=</span> <span class="st">"Distribuciones de densidad de X.protombina"</span>, </span>
<span>     xlab <span class="op">=</span> <span class="st">"X.protombina"</span>, </span>
<span>     ylab <span class="op">=</span> <span class="st">"Densidad"</span>, </span>
<span>     col <span class="op">=</span> <span class="st">"blue"</span>, </span>
<span>     lwd <span class="op">=</span> <span class="fl">2</span>, </span>
<span>     ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">densidad_cirroticos</span><span class="op">$</span><span class="va">y</span>, <span class="va">densidad_sanos</span><span class="op">$</span><span class="va">y</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">densidad_sanos</span>, col <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Cirróticos"</span>, <span class="st">"Sanos"</span><span class="op">)</span>, </span>
<span>       col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"red"</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="tema_2_28_11_2024_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#Ref: Estimación no paramétrica de la función de densidad. Antonio Miñarro 1998</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Aparentemente los sanos tienen valores superiores a los cirróticos y esto es al revés que muchos default. Intercambaimos los valores de casos y controles.</p>
<p>Los “casos” siempre son los que tienen mayor valor, en este caso los “casos” son los sanos.</p>
<p>Me parecía poco intuitivo ese valor del área bajo la curva (ROC) al observar cómo se solapan las distribuciones. Sin embargo, es cierto que lo que realmente se solapan son los rangos en los que se distribuyen los datos. Por debajo del punto donde las distribuciones se cruzan, la densidad de los datos en el grupo de los sanos es muy baja.</p>
</section><section id="suavizado-tipo-núcleo" class="level3"><h3 class="anchored" data-anchor-id="suavizado-tipo-núcleo">Suavizado tipo núcleo</h3>
<p>Ha dicho algo de nucleos y suavizado.</p>
<p>La curva ROC empírica es una función escalonada a pesar de que la curva ROC es continua. Además, parece razonable construir estimadores que también sean continuos. Estos se pueden obtener de forma no paramétrica mediante técnicas de suavización, por ejemplo de tipo núcleo:</p>
<p><span class="math display">\[
F_{D, h_D}(y) = \frac{1}{n_D} \sum_{i=1}^{n_D} K \left( \frac{y - y_{D_i}}{h_D} \right)
\]</span></p>
<p><span class="math display">\[
F_{\bar{D}, h_{\bar{D}}}(y) = \frac{1}{n_{\bar{D}}} \sum_{i=1}^{n_{\bar{D}}} K \left( \frac{y - y_{\bar{D}_i}}{h_{\bar{D}}} \right)
\]</span></p>
<p>donde <span class="math inline">\(F_D\)</span> y <span class="math inline">\(F_{\bar{D}}\)</span> son las funciones de distribución de enfermos y sanos, y <span class="math inline">\(K(t) = \int_{-\infty}^t k(u) \, du\)</span> es la función kernel.</p>
<p><span class="math display">\[
\widehat{\text{ROC}}(t) = 1 - F_{D, h_D} \left( F_{\bar{D}, h_{\bar{D}}}^{-1} (1 - t) \right), \quad t \in (0, 1).
\]</span></p>
<p>En R nos deja elegir el nucleo pero no la ventana. la ventana tiene aplicacion en diagnostico por imagen</p>
<p>Existen varios métodos para el suavizado.</p>
<ul>
<li><p>Binormal. Se utiliza una aproximación normal para la densidad de los datos. La curva ROC se estima bajo la suposición de que los datos provienen de distribuciones normales (binormalidad), con medias y varianzas estimadas a partir de la muestra.</p></li>
<li><p>Densidad. Se estima la densidad de los datos utilizando un núcleo considerado adecuado. Aunque se ha mencionado que es “perfecto”, no queda claro a qué se refiere exactamente dicha afirmación.</p></li>
<li><p>Best-Fit Distribution. Es la distribución que mejor se ajusta a los datos, determinada mediante el método de máxima verosimilitud.</p></li>
<li><p>lognormal: …</p></li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org">readr</a></span><span class="op">)</span></span>
<span><span class="va">datos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_delim</a></span><span class="op">(</span><span class="st">"Protom_SanCirr.csv"</span>, delim <span class="op">=</span> <span class="st">";"</span>, escape_double <span class="op">=</span> <span class="cn">FALSE</span>, trim_ws <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">roc1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pROC/man/roc.html">roc</a></span><span class="op">(</span><span class="va">datos</span><span class="op">$</span><span class="va">`cirroticos/sanos`</span>,<span class="va">datos</span><span class="op">$</span><span class="va">`%protombina`</span><span class="op">)</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">roc1</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 15
 $ percent           : logi FALSE
 $ sensitivities     : num [1:48] 1 1 0.974 0.949 0.949 ...
 $ specificities     : num [1:48] 0 0.421 0.441 0.455 0.476 ...
 $ thresholds        : num [1:48] Inf 99 97 95.5 94.5 ...
 $ direction         : chr "&gt;"
 $ cases             : num [1:39] 36 71 50 50 45 42 37 40 42 52 ...
 $ controls          : num [1:145] 100 73 73 80 57 90 80 75 78 100 ...
 $ fun.sesp          :function (thresholds, controls, cases, direction)  
 $ auc               : 'auc' num 0.897
  ..- attr(*, "partial.auc")= logi FALSE
  ..- attr(*, "percent")= logi FALSE
  ..- attr(*, "roc")=List of 15
  .. ..$ percent           : logi FALSE
  .. ..$ sensitivities     : num [1:48] 1 1 0.974 0.949 0.949 ...
  .. ..$ specificities     : num [1:48] 0 0.421 0.441 0.455 0.476 ...
  .. ..$ thresholds        : num [1:48] Inf 99 97 95.5 94.5 ...
  .. ..$ direction         : chr "&gt;"
  .. ..$ cases             : num [1:39] 36 71 50 50 45 42 37 40 42 52 ...
  .. ..$ controls          : num [1:145] 100 73 73 80 57 90 80 75 78 100 ...
  .. ..$ fun.sesp          :function (thresholds, controls, cases, direction)  
  .. ..$ auc               : 'auc' num 0.897
  .. .. ..- attr(*, "partial.auc")= logi FALSE
  .. .. ..- attr(*, "percent")= logi FALSE
  .. .. ..- attr(*, "roc")=List of 8
  .. .. .. ..$ percent      : logi FALSE
  .. .. .. ..$ sensitivities: num [1:48] 1 1 0.974 0.949 0.949 ...
  .. .. .. ..$ specificities: num [1:48] 0 0.421 0.441 0.455 0.476 ...
  .. .. .. ..$ thresholds   : num [1:48] Inf 99 97 95.5 94.5 ...
  .. .. .. ..$ direction    : chr "&gt;"
  .. .. .. ..$ cases        : num [1:39] 36 71 50 50 45 42 37 40 42 52 ...
  .. .. .. ..$ controls     : num [1:145] 100 73 73 80 57 90 80 75 78 100 ...
  .. .. .. ..$ fun.sesp     :function (thresholds, controls, cases, direction)  
  .. .. .. ..- attr(*, "class")= chr "roc"
  .. ..$ call              : language roc.default(response = datos$`cirroticos/sanos`, predictor = datos$`%protombina`)
  .. ..$ original.predictor: num [1:184] 100 73 73 80 57 90 80 75 78 100 ...
  .. ..$ original.response : num [1:184] 0 0 0 0 0 0 0 0 0 0 ...
  .. ..$ predictor         : num [1:184] 100 73 73 80 57 90 80 75 78 100 ...
  .. ..$ response          : num [1:184] 0 0 0 0 0 0 0 0 0 0 ...
  .. ..$ levels            : chr [1:2] "0" "1"
  .. ..- attr(*, "class")= chr "roc"
 $ call              : language roc.default(response = datos$`cirroticos/sanos`, predictor = datos$`%protombina`)
 $ original.predictor: num [1:184] 100 73 73 80 57 90 80 75 78 100 ...
 $ original.response : num [1:184] 0 0 0 0 0 0 0 0 0 0 ...
 $ predictor         : num [1:184] 100 73 73 80 57 90 80 75 78 100 ...
 $ response          : num [1:184] 0 0 0 0 0 0 0 0 0 0 ...
 $ levels            : chr [1:2] "0" "1"
 - attr(*, "class")= chr "roc"</code></pre>
</div>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span> <span class="co">#Dibujamos</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">roc1</span>,legacy.axes <span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rs</span> <span class="op">&lt;-</span> <span class="fu">smooth</span><span class="op">(</span><span class="va">roc1</span>, method<span class="op">=</span><span class="st">"binormal"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">rs</span>, add<span class="op">=</span><span class="cn">TRUE</span>, col<span class="op">=</span><span class="st">"green"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rs2</span> <span class="op">&lt;-</span> <span class="fu">smooth</span><span class="op">(</span><span class="va">roc1</span>, method<span class="op">=</span> <span class="st">"density"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">rs2</span>, add<span class="op">=</span><span class="cn">TRUE</span>, col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rs3</span> <span class="op">&lt;-</span> <span class="fu">smooth</span><span class="op">(</span><span class="va">roc1</span>, method<span class="op">=</span><span class="st">"fitdistr"</span>, density<span class="op">=</span><span class="st">"lognormal"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">rs3</span>, add<span class="op">=</span><span class="cn">TRUE</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">"bottomright"</span>, legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Empírica"</span>,<span class="st">"Binormal"</span>,<span class="st">"Densidad"</span>,<span class="st">"Lognormal"</span><span class="op">)</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"black"</span>,<span class="st">"green"</span>,<span class="st">"blue"</span>,<span class="st">"red"</span><span class="op">)</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="tema_2_28_11_2024_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>El AUC es el mismo porque se estima utilizando la distribución empírica. La versión normalizada se emplea únicamente para representar gráficamente la curva ROC, ya que proporciona una visualización <strong>más intuitiva</strong>. Lo que hace es trazar la curva de manera más “estética”, generando una forma <strong>más continua y suave</strong>, en contraste con la versión empírica, que tiende a ser más <strong>poligonal y escalonada</strong>.</p>
</section></section><section id="intervalos-y-bandas-de-confianza" class="level2"><h2 class="anchored" data-anchor-id="intervalos-y-bandas-de-confianza">Intervalos y bandas de confianza</h2>
<p>Cuando la muestra es pequeña, solo es posible “repetir el experimento” utilizando el método bootstrap, generando nuevas muestras (tengo muestas de sanos y de enfermos) de igual tamaño que las originales, respetando la proporción entre los grupos de sanos y enfermos.</p>
<p>Fijado, se puede calcular la sensibilidad y la especificidad correspondientes para cada muestra bootstrap, lo que permite estimar una región de confianza para estos valores.</p>
<p>Si se mantiene fija una de las dimensiones (tanto la sensibilidad como la especificidad), es posible observar cómo varía la otra dimensión (en este caso, la especificidad) y determinar el rango en el que se encuentra, es decir, “fijada la sensibilidad, ver de qué punto a qué punto varía la especificidad”.</p>
<p>[aquí ha hecho un dibujito muy boniko que a ver si lo replico.]</p>
<p>La diferencia entre las bandas de confianza obtenidas mediante el método bootstrap y las obtenidas a través de la aproximación asintótica es muy pequeña.</p>
<p>La variabilidad muestral para la curva ROC empírica puede obtenerse desde varios puntos de vista: dipo76.</p>
<section id="comparación-de-curvas-roc" class="level3"><h3 class="anchored" data-anchor-id="comparación-de-curvas-roc">Comparación de curvas ROC</h3>
<p>lleva emparejado dos biomarcadores en dos muestras pareaadas o no pareadas, dependiendo del tipo de muestras usaremos un tipo de comparación y otra.</p>
<p>El estimador que se suele usar es la diferencia de las AUC, normalizado para tener una distribucion asintotica.</p>
<p>Sean dos pruebas diagnósticas A, B =&gt; H0: ROC_A = ROC_B</p>
<p>Si las AUC son diferentes automáticamente tenemos curvas distintas (al revés no)</p>
<p>aparece la supervivencia ya que los sanos</p>
<p>prob acumulada : densidad prob de colas : prob de supervivencia</p>
<p>diapo83</p>
<p>2a.</p>
<p>si miramos las curvas (a parte de los resultados) nos gustaría saber si las consideramos la misma o no</p>
<p>el p value para contrastar la hipotesis es p-value = 0.03075. si hacemos una comparacoin entre dos curvas podemos decir que no son la misma. si usamos DeLongs, el estadistico es diferente con otra dist asintotica pero decimos lo mismo. Y con Venkatraman pues eso.</p>
<p>bootstrap aqui es inutil pq es mecanico y tal… no sé, que computacionalmente no tiene sentido, ¿creo?</p>
<p>para esta especi de 0.9, ¿las dos pruebas me dan sensibilidades que son distintas?</p>
<p>caramba, pvalor 0.2, con lo cual las dos pruebas (partiendo de una especi de 0.9) conducen a la misma sensibilidad. y si aplico bootstrap (para hacerlo al reves, fijando sensi) me dice que no: si fijo sensi de 0.9 no admito que las dos rpeubas tenga la misma especi.</p>
<p>no tengo evidencia que para una especi de 0.9 las dos sensi sean iguales</p>
<p>en diapo85, para una especi de 0.9 se contrasta si la sensi_ = sensi_B. con pvalor 0.2 admito la hipóteis. no tnemos evidencias de que la sensi de ambas pruebas conese nivel de especi sea diferente.</p>
<p>la segunda salida es fijo la sensi a 0.9 y contrasto si la especi de esas dos pruebas coinciden o no. con pvalor infimo puedo descartar que la especi sea igual.</p>
<p>esto es un argumento de autoridad (test y un apoyo teorico que me garantiza las cosas) pero visualmente viendo las curvas ROC debemos tener unas primeras impresiones.</p>
<p>“casualmete” la especi 0.9 es donde se cruzan las curvas ROC, por eso no se pueden diferencias las sensi.</p>
<p>pero cuando voy a mirar la seni 0.9 SÍ que hay diferencias entre as especifi</p>
</section><section id="elección-del-punto-de-corte-c" class="level3"><h3 class="anchored" data-anchor-id="elección-del-punto-de-corte-c">Elección del punto de corte c</h3>
<p>Valor que hace que la pd asigne como positivo o negativo un resultado.</p>
<p>según algún criterio.</p>
<p>a la hora de tener una estimacion del AUC y sobre todo su Ic nos va a dar una pista para decidir qué tipo de prueba tenemos.</p>
<p>AUC – categoria &lt;0.6 – prueba caca y no merece la pensa hacer nada con ella 0.7-0.8 – buena 0.8-0.9 – buena 0.9 - 1 – excelente</p>
<p>si el AUC estimado con sus intervalos del IC es claramente menor a 0.6 la verdad es que podemos obviar esa curva ROC y no hace falta hacer ninguna comparativa con otra (alargar esta frase para resolver todos los casos pero vamos, que está entendido)</p>
<p>diapo87</p>
<p>indice de youden: buscar test que tiene mayor sensi y especi</p>
<p>en otro es buscar que tenga misma sensi y misma especi</p>
<p>en el tercer caso queremos maximizar una de ellas</p>
<p>todas basadas en tener maxima sensi y maxima especi, dentro de lo que ofrece la prueba. si la sensi no sube de 0.6, por más que intentemos maximizarla no podremos (esto no lo entiendo, porque al final si disminuyes el pc debería poder llegar a 1)</p>
<p>diapo89. consideramos positivo si mayor a 37, pero eso no me dice nada sober la prueba. miramos el auc y es 0.74. no puedo descartar esa prueba, ya que con el IC a veces llega a ser buena.</p>
<p>interpretacion de AUC. asignando e mayor de los valores a los enfermos aciertarias estimadamente en el 74 % de las veces pudiendo variasr entre un 66 y un 62.</p>
<p>acierto en una proporcion del 68 %. el ic marca 0.58 qye es muy poco pq 0.5 ya es puro azar y va hasta el 0.77 aunque muy lejos del 1. no pinta bien esta prueba eh</p>
<p>la descriptiva nos hubiera ayudado mucho.</p>
<p>antes estábamos mirando todo junto. ahora separamos entre muejres y hombres.</p>


</section></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copiado");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copiado");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation column-body"><div class="nav-page nav-page-previous">
      <a href="../tema_02/tema_02_2_comparacion_test_y_tamanyos_muestrales.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-title">2. Comparación de test y tratamiento del tamaño mmuestral <span style="color:red;">✗</span></span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../tema_02/tema_02_3_curvas_roc.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-title">3. Validación de biomarcadores. Curvas ROC <span style="color:red;">✗</span></span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>
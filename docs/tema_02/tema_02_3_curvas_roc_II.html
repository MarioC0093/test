<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="es" xml:lang="es"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Máster de Bioestadística - Probabilidad y Simulación</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../tema_02/tema_02_3_curvas_roc_final.html" rel="next">
<link href="../tema_02/tema_02_2_comparacion_test_y_tamanyos_muestrales_II.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "Sin resultados",
    "search-matching-documents-text": "documentos encontrados",
    "search-copy-link-title": "Copiar el enlace en la búsqueda",
    "search-hide-matches-text": "Ocultar resultados adicionales",
    "search-more-match-text": "resultado adicional en este documento",
    "search-more-matches-text": "resultados adicionales en este documento",
    "search-clear-button-title": "Borrar",
    "search-detached-cancel-button-title": "Cancelar",
    "search-submit-button-title": "Enviar",
    "search-label": "Buscar"
  }
}</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><link rel="stylesheet" href="../css/styles.css">
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../tema_02/tema_02.html">TEMA 2</a></li><li class="breadcrumb-item"><a href="../tema_02/tema_02_3_curvas_roc_II.html"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">3. Validación de biomarcadores. Curvas ROC <span style="color:green;">✓</span></span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Buscar"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Introducción</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../DUDAS.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Dudas</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../tema_00/tema_00.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">TEMA 0</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Alternar sección">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tema_00/tema_00_introduccion.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Introducción</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../tema_01/tema_01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">TEMA 1</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Alternar sección">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tema_01/tema_01_1_introduccion.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">1. Introducción <span style="color:green;">✓</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tema_01/tema_01_2_concordancia_categoricas.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">2. Análisis de concordancia en variables categóricas <span style="color:green;">✓</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tema_01/tema_01_3_concordancia_numericas.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">3. Análisis de concordancia en variables numéricas <span style="color:green;">✓</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tema_01/tema_01_4_tamanyo_muestral.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">4. Cálculo del tamaño muestral <span style="color:green;">✓</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../tema_02/tema_02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">TEMA 2</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Alternar sección">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tema_02/tema_02_1_introduccion.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">1.1. Conceptos básicos <span style="color:green;">✓</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tema_02/tema_02_2_comparacion_test_y_tamanyos_muestrales_I.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">2. Comparación de test y tratamiento del tamaño muestral (I) <span style="color:green;">✓</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tema_02/tema_02_2_comparacion_test_y_tamanyos_muestrales_II.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">2. Comparación de test y tratamiento del tamaño muestral (II) <span style="color:green;">✓</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tema_02/tema_02_3_curvas_roc_II.html" class="sidebar-item-text sidebar-link active"><span class="chapter-title">3. Validación de biomarcadores. Curvas ROC <span style="color:green;">✓</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tema_02/tema_02_3_curvas_roc_final.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">curvas ROC - segunda parte</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../tema_03/tema_03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">TEMA 3</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Alternar sección">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tema_03/tema_03_1_introduccion.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">1. Introducción <span style="color:green;">✓</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tema_03/tema_03_2_selección_aleatoria.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">2. Selección aleatoria de pacientes y asignación de tratamientos <span style="color:red;">✗</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tema_03/tema_03_3_obtener_datos_simulados.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">3. Obtener datos simulados a partir de observaciones reales <span style="color:green;">✓</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tema_03/tema_03_4_remuestreo_inferencia_roc.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">4. Técnicas de remuestreo aplicadas a la inferencia de curvas ROC <span style="color:red;">✗</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="99"><h2 id="toc-title">In this page</h2>
   
  <ul>
<li>
<a href="#%C3%ADndices-o-medidas-resumen-la-curva-roc" id="toc-índices-o-medidas-resumen-la-curva-roc" class="nav-link active" data-scroll-target="#%C3%ADndices-o-medidas-resumen-la-curva-roc">Índices o medidas resumen la curva ROC:</a>
  <ul>
<li><a href="#auc" id="toc-auc" class="nav-link" data-scroll-target="#auc">AUC</a></li>
  <li><a href="#pauc" id="toc-pauc" class="nav-link" data-scroll-target="#pauc">pAUC</a></li>
  <li><a href="#%C3%ADndice-de-youden" id="toc-índice-de-youden" class="nav-link" data-scroll-target="#%C3%ADndice-de-youden">Índice de Youden</a></li>
  </ul>
</li>
  <li><a href="#estimaci%C3%B3n-de-curvas-roc" id="toc-estimación-de-curvas-roc" class="nav-link" data-scroll-target="#estimaci%C3%B3n-de-curvas-roc">Estimación de curvas ROC</a></li>
  <li>
<a href="#estimaci%C3%B3n-param%C3%A9trica-de-curvas-roc" id="toc-estimación-paramétrica-de-curvas-roc" class="nav-link" data-scroll-target="#estimaci%C3%B3n-param%C3%A9trica-de-curvas-roc">Estimación paramétrica de curvas ROC</a>
  <ul>
<li><a href="#m%C3%A9todo-binormal" id="toc-método-binormal" class="nav-link" data-scroll-target="#m%C3%A9todo-binormal">Método binormal</a></li>
  </ul>
</li>
  <li>
<a href="#estimaci%C3%B3n-no-param%C3%A9trica-de-curvas-roc" id="toc-estimación-no-paramétrica-de-curvas-roc" class="nav-link" data-scroll-target="#estimaci%C3%B3n-no-param%C3%A9trica-de-curvas-roc">Estimación no paramétrica de curvas ROC</a>
  <ul>
<li><a href="#m%C3%A9todo-emp%C3%ADrico" id="toc-método-empírico" class="nav-link" data-scroll-target="#m%C3%A9todo-emp%C3%ADrico">Método empírico</a></li>
  <li><a href="#suavizado-tipo-n%C3%BAcleo" id="toc-suavizado-tipo-núcleo" class="nav-link" data-scroll-target="#suavizado-tipo-n%C3%BAcleo">Suavizado tipo núcleo</a></li>
  </ul>
</li>
  <li>
<a href="#intervalos-y-bandas-de-confianza" id="toc-intervalos-y-bandas-de-confianza" class="nav-link" data-scroll-target="#intervalos-y-bandas-de-confianza">Intervalos y bandas de confianza</a>
  <ul>
<li><a href="#intervalos-de-confianza-para-las-medidas-resumen" id="toc-intervalos-de-confianza-para-las-medidas-resumen" class="nav-link" data-scroll-target="#intervalos-de-confianza-para-las-medidas-resumen">Intervalos de confianza para las medidas resumen</a></li>
  </ul>
</li>
  <li>
<a href="#comparaci%C3%B3n-de-curvas-roc" id="toc-comparación-de-curvas-roc" class="nav-link" data-scroll-target="#comparaci%C3%B3n-de-curvas-roc">Comparación de curvas ROC</a>
  <ul>
<li><a href="#curvas-no-pareadas" id="toc-curvas-no-pareadas" class="nav-link" data-scroll-target="#curvas-no-pareadas">Curvas no pareadas:</a></li>
  </ul>
</li>
  <li>
<a href="#elecci%C3%B3n-del-punto-de-corte-c" id="toc-elección-del-punto-de-corte-c" class="nav-link" data-scroll-target="#elecci%C3%B3n-del-punto-de-corte-c">Elección del punto de corte c</a>
  <ul>
<li><a href="#criterios-de-elecci%C3%B3n" id="toc-criterios-de-elección" class="nav-link" data-scroll-target="#criterios-de-elecci%C3%B3n">Criterios de elección</a></li>
  </ul>
</li>
  <li><a href="#determinaci%C3%B3n-de-tama%C3%B1os-muestrales" id="toc-determinación-de-tamaños-muestrales" class="nav-link" data-scroll-target="#determinaci%C3%B3n-de-tama%C3%B1os-muestrales">Determinación de tamaños muestrales</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title"><span class="chapter-title">3. Validación de biomarcadores. Curvas ROC <span style="color:green;">✓</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><p>Se trata de una curva bidimensional donde para cualquier punto posible de la prueba calculamos la probabilidad de positivos en sanos y de negativos en enfermos.</p>
<p>Se utiliza para la comparación de biomarcadores.</p>
<ul>
<li>En pruebas diagnósticas donde los resultados no son positivo/negativo.<br>
</li>
<li>Validacion de biomarcadores cuando los resultados de la prueba diagnóstica tienen varios niveles.</li>
</ul>
<p><strong>Por convenio, se establece que los valores de la prueba en enfermos son superiores que en individuos sanos.</strong> (en los ejercicios, en el default de R, etc.)</p>
<p><u><strong>Definición</strong></u> Umbral: punto a partir del cual se decide que la prueba diagnóstica asigna un positivo.<br>
- Si es un umbral a partir del cual hago una prueba invasiva, que sea alto.<br>
- Si es un umbral a partir del cual hago una prueba no invasiva, barata, etc. puedo elegir un umbral bajo.</p>
<p>Se dicotomizan los resultados de la prueba diagnóstica en base a un treshold c.</p>
<p>Dado un valor c, la probabilidad de tener en los dos grupos un valor por encima de c:<br>
- <span class="math inline">\(Se(c) = TPF = P(Y \ge c | D=1)\)</span><br>
- <span class="math inline">\(1-Sp(c) = FPF =P(Y \ge c |D=0)\)</span></p>
<p>Se trata de elegir un punto de corte teniendo en cuenta el equilibrio (o el equilibrio deseado) entre los errores.</p>
<p><span class="math inline">\(ROC(\cdot) = \left\{ (1 - Sp(c), Se(c)), \, c \in (-\infty, +\infty) \right\}\)</span></p>
<p>Probabilidad de tener en los enfermos un valor por encima de c y probabilidad de tener en los sanos un valor por encima de c.</p>
<p>Si c <span class="math inline">\(\rightarrow\)</span> -inf =&gt; <span class="math inline">\(Se = 1\)</span> y <span class="math inline">\(Sp=1\)</span><br>
si c <span class="math inline">\(\rightarrow\)</span> +inf =&gt; <span class="math inline">\(Se = 0\)</span> y <span class="math inline">\(Sp=0\)</span></p>
<div class="recuadro_1">
<p>Se desea que una curva ROC distinguiese perfectamente entre sanos y enfermos (esto sería una prueba perfecta, ya que discrima sin errores).</p>
<p>Una prueba perfecta es quella donde la curva que representa la distribución de los resultados de los enfermos y la curva que representa la distribución de los resultados de los sanos son claramente diferenciables y espaciadas entre ellas.</p>
<p>Si las curva de densidad para D=0 y D=1 se solapan y son iguales, se trata de una prueba inutil.</p>
<p>Cuando representamos la curva ROC de dos pruebas diagnósticas podemos decir que una prueba es mejor que la otra si las curvas ROC no se cruzan y una está por encima de la otra.</p>
</div>
<p><u><strong>Ejemplo 2.5.</strong></u></p>
<p>Una prueba diagnóstica para la cirrosis consiste en medir el diámetro de hematíes (Y). Supongamos que en los individuos sin cirrosis Y sigue una distribución N(7.5,0.2) y en los cirróticos una N(8.5, 0.6).</p>
<p>Calculo para cada distribución la probabilidad de tener un valor menor a c.</p>
<ul>
<li>Para c=6.
<ul>
<li><span class="math inline">\(Se(6) = p(Y \ge 6 | D=1) = 1\)</span></li>
<li><span class="math inline">\(1-sp(6) = p(Y \ge 6 | D=1) = 1\)</span></li>
</ul>
</li>
<li>Para c=8.5.
<ul>
<li><span class="math inline">\(Se(8.5) = p(Y \ge 8.5 | D=1) = 1\)</span></li>
<li><span class="math inline">\(1-sp(8.5) = p(Y \ge 8.5 | D=1) = 0.5\)</span></li>
</ul>
</li>
</ul>
<div style="text-align: center;">
<strong>Al dibujar la ROC el valor del umbral no aparece en la curva.</strong>
</div>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>c<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/double.html">double</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                 `1-Sp`<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/double.html">double</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>                 Se<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/double.html">double</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">c</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">6.5</span>, <span class="fl">10.5</span>, <span class="fl">0.025</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">sp_sincirrosis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">pnorm</a></span><span class="op">(</span>q <span class="op">=</span> <span class="va">c</span>, mean<span class="op">=</span><span class="fl">7.5</span>, sd<span class="op">=</span><span class="fl">0.2</span>, lower.tail<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="va">se_concirrosis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">pnorm</a></span><span class="op">(</span>q <span class="op">=</span> <span class="va">c</span>, mean<span class="op">=</span><span class="fl">8.5</span>, sd<span class="op">=</span><span class="fl">0.6</span>, lower.tail<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">df</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">c</span>,<span class="fl">1</span><span class="op">-</span><span class="va">sp_sincirrosis</span>,<span class="va">se_concirrosis</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'c'</span>, <span class="st">'1-Sp'</span>, <span class="st">'Se'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">##        c      1-Sp        Se</span></span>
<span><span class="co">## 1  6.500 0.9999997 0.9995709</span></span>
<span><span class="co">## 2  6.525 0.9999995 0.9995020</span></span>
<span><span class="co">## 3  6.550 0.9999990 0.9994230</span></span>
<span><span class="co">## 4  6.575 0.9999981 0.9993325</span></span>
<span><span class="co">## 5  6.600 0.9999966 0.9992290</span></span>
<span><span class="co">## 6  6.625 0.9999939 0.9991110</span></span>
<span><span class="co">## 7  6.650 0.9999893 0.9989765</span></span>
<span><span class="co">## 8  6.675 0.9999815 0.9988236</span></span>
<span><span class="co">## 9  6.700 0.9999683 0.9986501</span></span>
<span><span class="co">## 10 6.725 0.9999467 0.9984535</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">df</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">`1-Sp`</span>, y <span class="op">=</span> <span class="va">Se</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># geom_line(color = "blue", size = 1) +</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"red"</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Curva ROC"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"1 - Especificidad (Tasa de Falsos Positivos)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Sensibilidad (Tasa de Verdaderos Positivos)"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="tema_02_3_curvas_roc_II_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Para estudiar las propiedas de la curva ROC se varían valores de <em>c</em> entre [0, 1] y se trabaja con funciones de supervivencia.</p>
<p>Dado un punto de corte c : ROC(c) = “Probabilidad de que la respuesta del test en los enfermos sea superior a la respuesta máxima observada en los sanos con probabilidad (1-c).”</p>
<p>Cuando cambiamos las propiedades de la prueba diagnóstica mediante una transformacion creciente la ROC es la misma. Esto será algo que buscaremos <strong>cuando la transformación nos proporcione normalidad</strong>.</p>
<p><strong>Interpretación.</strong></p>
<ul>
<li>La curva ROC representa la capacidad discriminadora de una prueba diagnóstica a lo largo de todos los posibles puntos de corte.</li>
<li>Es una medida global de precisión diagnóstica, independientemente del punto de corte y de la prevalencia de la enfermedad.</li>
<li>Es una guía en la selección del punto de corte en las pruebas diagnósticas.</li>
</ul>
<section id="índices-o-medidas-resumen-la-curva-roc" class="level2"><h2 class="anchored" data-anchor-id="índices-o-medidas-resumen-la-curva-roc">Índices o medidas resumen la curva ROC:</h2>
<section id="auc" class="level3"><h3 class="anchored" data-anchor-id="auc">AUC</h3>
<p><strong>Caso de uso.</strong> Eligiendo un par de resultados (uno de la muestra de sanos y otro de la muestra de enfermos) la probabilidad de clasificar correctamente cuando se asigna como sano aquel con menor valor en la prueba y como enfermo aquel que tiene mayor valor en la en la prueba es igual a AUC.</p>
<p><span class="math inline">\(AUC = p(Y_D &gt; Y_\overline{D})\)</span></p>
<ul>
<li>Test perfecto: <span class="math inline">\(AUC=1\)</span>.</li>
<li>Test noinformativo: <span class="math inline">\(AUC=0.5\)</span>.</li>
<li>Dados dos test A y B tales que <span class="math inline">\(ROC_A(t) \ge ROC_(t), \forall t \in [0,1] \Rightarrow AUC_A \ge AUC_B\)</span>, pero no se cumple en ambas direcciones.</li>
</ul>
<p>Si una prueba es más sensible que otra solo para algunos umbrales, diremos que la prueba es preferible solo en algunos casos.</p>
</section><section id="pauc" class="level3"><h3 class="anchored" data-anchor-id="pauc">pAUC</h3>
<p>En casos donde las curvas ROC de dos pruebas diagnósticas se cruzan y las áreas bajo las curvas <strong>son similares</strong>.</p>
<p><a href="../attachments/tema_03_prueba_sensible_segun_umbral.png" width="75%" height="75%"></a></p>
<p>El test B demuestra un mejor desempeño en el intervalo [0,0.25]. Este desempeño superior se debe a que la sensibilidad y especificidad de dicha prueba superan a las del test A en este rango. Sin embargo, a partir de este punto, la interpretación se invierte: el test A pasa a ser superior tanto en sensibilidad como en especificidad.</p>
<p>En general, no existe una prueba que supere consistentemente a la otra en todo el rango evaluado. Es útil considerar el área bajo la curva parcial para realizar comparaciones más específicas y establecer puntos de corte que sean coherentes con el comportamiento de ambas curvas en los distintos intervalos.</p>
</section><section id="índice-de-youden" class="level3"><h3 class="anchored" data-anchor-id="índice-de-youden">Índice de Youden</h3>
<p>Algunas publicaciones lo defines como una distancia y otras lo definen como la mayor distancia.</p>
<p><strong>Distancia entre mi curva ROC y la diagonal.</strong></p>
<p><span class="math inline">\(YI(c) = |Se(c) + Sp(c) - 1|\)</span></p>
<ul>
<li>Test perfecto: <span class="math inline">\(max YI(c)= 1\)</span>.</li>
<li>Test noinformativo: <span class="math inline">\(YI(c)=0 \quad \forall \quad c\)</span>.</li>
<li>Dados dos test A y B tales que <span class="math inline">\(ROC_A(t) \ge ROC_(t), \forall t \in [0,1] \Rightarrow AUC_A \ge AUC_B\)</span>, pero no se cumple en ambas direcciones.z</li>
</ul>
<p><span class="math inline">\(YI(c) = 0 \; \forall \; c\)</span>ç <span class="math inline">\(YI(c) = 0 \, \forall \, c\)</span></p>
<p>Dependiendo de cuánto se conozca sobre la prueba diagnóstica a nivel estadístico, la forma de trabajar con la curva ROC será de una manera u otra.</p>
</section></section><section id="estimación-de-curvas-roc" class="level2"><h2 class="anchored" data-anchor-id="estimación-de-curvas-roc">Estimación de curvas ROC</h2>
<p>En caso de conocer el comportamiento de la prueba diagnóstica (la distribución de los resultados) uso una metodología paramétrica (la cual es idonea si los grupos de sanos y enfermos se distribuyen normalmente o se pueden transformar para tener normalidad).</p>
<p>Eficaz con conjuntos de datos desequilibrados: En los conjuntos de datos en los que una clase domina significativamente, las métricas como la precisión pueden no proporcionar una imagen precisa. El AUC, que incorpora tanto el TPR como el FPR, es una métrica más fiable en estos casos.</p>
<p>Lo más habitual es tener una prueba diagnóstica donde solo tenemos una muestra y <strong>no tenemos información de la distribución</strong> de la prueba (<strong>de los resultados</strong>) <strong>que podamos usar en el modelo teórico.</strong></p>
<p>Con el método empírico obtenemos curvas escaloanadas. Visualmente es <em>feo</em> y no es lo esperable, ya que estamos trabajando con una variable numerica. En tales casos aplicamos un suavizado.</p>
</section><section id="estimación-paramétrica-de-curvas-roc" class="level2"><h2 class="anchored" data-anchor-id="estimación-paramétrica-de-curvas-roc">Estimación paramétrica de curvas ROC</h2>
<ul>
<li><p>Distribuciones paramétricas conocidas para la prueba diagnóstica en las poblaciones de enfermos y sanos.</p></li>
<li><p>Cuanto mejor se ajusten los datos a las distribuciones mejores serán las conclusiones clínicas.</p></li>
<li><p>Distribuciones más populares: normales y lognormales</p></li>
</ul>
<section id="método-binormal" class="level3"><h3 class="anchored" data-anchor-id="método-binormal">Método binormal</h3>
<p>Sea <span class="math inline">\(Y_D \sim N(\mu_D, \sigma^2_D)\)</span> y sea <span class="math inline">\(Y_\overline{D} \sim N(\mu_\overline{D}, \sigma^2_\overline{D})\)</span>.</p>
<p>Entonces,</p>
<p><span class="math display">\[
ROC(t) = \Phi\left( \frac{\mu_D - \mu_{\overline{D}}}{\sigma_D} + \frac{\sigma_{\overline{D}}}{\sigma_D} \Phi^{-1}(t) \right)
\]</span></p>
<p><span class="math display">\[
AUC= \Phi\left( \frac{\mu_D - \mu_{\overline{D}}}{\sqrt{\sigma^2_D + \sigma^2_\overline{D}}} \right) : \Phi(a) = p(Z&lt;a), \; Z \sim N(0,1)
\]</span></p>
<p>En caso de desconocer la media o varianza poblacionales pasamos a tener una estimación de la curva ROC construida a través de la estimación puntual de la media y la varianza con los datos muestrales.</p>
<p><span class="math display">\[
\widehat{ROC}(t) = \Phi\left( \frac{\widehat{\mu}_D - \widehat{\mu}_{\overline{D}}}{\widehat{\sigma}_D} + \frac{\widehat{\sigma}_{\overline{D}}}{\widehat{\sigma}_D} \Phi^{-1}(t) \right)
\]</span></p>
<p><span class="math display">\[
\widehat{AUC} = \Phi\left( \frac{\widehat{\mu_D} - \widehat{\mu}_{\overline{D}}}{\sqrt{\widehat{\sigma}^2_D + \widehat{\sigma}^2_\overline{D}}} \right)
\]</span></p>
<p>Desconocer la distribucion de la prueba diagnóstica no impide poder hacer estimaciones puntuales para la sensibilidad y la especificidad.</p>
<p>La curva ROC es invariante ante transformaciones estrictamente crecientes. Decir que la curva ROC es binormal implica que, mediante alguna transformación <span class="math inline">\(h\)</span> estrictamente creciente, <span class="math inline">\(h(Y_D)\)</span> y <span class="math inline">\(h(Y_\overline{D})\)</span> asumen distribuciones normales. (test de bondad de ajuste donde no rechazo normalidad)</p>
<p><strong>Algunas transformaciones que pueden usarse son las de tipo Box-Cox.</strong><br>
- <span class="math inline">\(X^a : a \ne 0\)</span>, solo si la prueba diagnóstica puede tener solo resultados positivos.<br>
- <span class="math inline">\(log(X)\)</span></p>
<p><u><strong>Ejemplo 2.5.</strong></u></p>
<p><span class="math inline">\(D = enfermo\)</span> <span class="math inline">\(Y_{\over{D}} ~ N(7.5,0.2)\)</span> <span class="math inline">\(Y_{D} ~ N(8.5,0.6)\)</span></p>
<p><span class="math display">\[
ROC(t) = \Phi\left( \frac{\mu_D - \mu_{\overline{D}}}{\sigma_D} + \frac{\sigma_{\overline{D}}}{\sigma_D} \Phi^{-1}(t) \right)
\]</span></p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ROC</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">mu_D</span>, <span class="va">mu_D_bar</span>, <span class="va">sigma_D</span>, <span class="va">sigma_D_bar</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># pnorm( (mu_D - mu_D_bar) / sigma_D + (sigma_D_bar / sigma_D) * qnorm(t) )</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">pnorm</a></span><span class="op">(</span> <span class="op">(</span><span class="va">mu_D</span> <span class="op">-</span> <span class="va">mu_D_bar</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">sigma_D_bar</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="va">sigma_D</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Ejemplo de uso con valores específicos</span></span>
<span><span class="va">t</span> <span class="op">&lt;-</span> <span class="fl">0.5</span>           <span class="co"># Valor del percentil</span></span>
<span><span class="va">mu_D</span> <span class="op">&lt;-</span> <span class="fl">8.5</span>          <span class="co"># Media de D</span></span>
<span><span class="va">mu_D_bar</span> <span class="op">&lt;-</span> <span class="fl">7.5</span>    <span class="co"># Media de D_bar</span></span>
<span><span class="va">sigma_D</span> <span class="op">&lt;-</span> <span class="fl">0.6</span>     <span class="co"># Desviación estándar de D</span></span>
<span><span class="va">sigma_D_bar</span> <span class="op">&lt;-</span> <span class="fl">0.2</span> <span class="co"># Desviación estándar de D_bar</span></span>
<span></span>
<span><span class="va">ROC_value</span> <span class="op">&lt;-</span> <span class="fu">ROC</span><span class="op">(</span><span class="va">t</span>, <span class="va">mu_D</span>, <span class="va">mu_D_bar</span>, <span class="va">sigma_D</span>, <span class="va">sigma_D_bar</span><span class="op">)</span></span>
<span><span class="va">ROC_value</span></span>
<span><span class="co">## [1] 0.9430769</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><span class="math inline">\(AUC = \Phi\left( \frac{8.5 - 7.5}{\sqrt{0.6^2 + 0.02^2}} \right) = \Phi(Z &lt; 1.58) = 0.9521\)</span></p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">AUC</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">pnorm</a></span><span class="op">(</span> <span class="op">(</span><span class="fl">8.5</span> <span class="op">-</span> <span class="fl">7.5</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fl">0.6</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="fl">0.02</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## [1] 0.9521175</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Es el area bajo la curva, no una estimacion.</p>
<p>Con el metodo binomal, siempre que tenemos información acerca de las respuestas de los dos grupos no tenemos una estimación del AUC, sino el AUC.</p>
<p>En el momento en que tenos que usar información adicional o estimar valores pasamos a tener una estimación del AUC.</p>
<p>En este caso al ser un dato exacto y no estimado no tenemos IC.</p>
<p><strong>Interpretación.</strong> Eligiendo dos valores (uno de cada muestra) y asignando el valor más alto a los enfermo (por defecto los valores más altos se asignas como los casos) entonces la probabilidad de acierto es el area bajo la curva.</p>
<p><strong>Un AUC estimado también tiene la misma interpretación que el AUC.</strong></p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">7.5</span>, <span class="fl">0.2</span><span class="op">)</span></span>
<span><span class="co">## [1] 7.460156</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">8.5</span>, <span class="fl">0.6</span><span class="op">)</span></span>
<span><span class="co">## [1] 8.654726</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Si tengo estos dos valores y asigno el primero a un no cirrótio y el segundo a un sí cirrot, mi prob de acercar es 0.4.</p>
<p>elijo dos valores (uno en cada muestra) y asigno el valor mas alto a los enfermo (por defecto los valores mas altos para los casos) entonces la prob de acierto es el area bajo la curva</p>
</section></section><section id="estimación-no-paramétrica-de-curvas-roc" class="level2"><h2 class="anchored" data-anchor-id="estimación-no-paramétrica-de-curvas-roc">Estimación no paramétrica de curvas ROC</h2>
<p>Se trata de casos donde solo tenemos información muestral: una muestra de resultados para los casos sanos y otra muestra de resultados para los casos enfermos.</p>
<section id="método-empírico" class="level3"><h3 class="anchored" data-anchor-id="método-empírico">Método empírico</h3>
<p>Es el método no paramétrico más usado tradicionalmente para pruebas diagnósticas continuas y se basa en las distribuciones empíricas de las muestras de sanos y enfermos.</p>
<p>Para cada una de las muestras miro la proporción de casos que se encuentran por encima del punto de corte.</p>
<p>En casos donde la variable respuesta es un biomarcador con unidades de medida, muchas veces la <strong>máquina correspondiente</strong> da pocos decimales o incluso ninguno. En esta situación estamos chocando con la hipótesis de que es imposible que dos individuos tengan el mismo valor para una variable continua. (esto se refleja en la curva ROC y ya veremos cómo impacta)</p>
<p>Sea <span class="math inline">\(\{Y_{D_i}, i = 1, \dots, n_D\} \; \text{m.a.s.} \; Y_D \; m.a.s Y_D\)</span> y sea <span class="math inline">\(\{Y_\overline{D_i}, i = 1, \dots, n_\overline{D_i}\} \; \text{m.a.s.} \; Y_\overline{D}\)</span>.</p>
<p>Para cada punto de corte <em>c</em> estimamos: <span class="math display">\[\hat{\text{Se}}(c) = \frac{1}{n_D} \sum_{i=1}^{n_D} I\{Y_{D_i} \geq c\} = \frac{\# I\{Y_{D_i} \geq c\}}{n_D}\]</span></p>
<p><span class="math display">\[1 - \hat{\text{Sp}}(c) = \frac{1}{\bar{n}_D} \sum_{i=1}^{\bar{n}_D} I\{Y_{\bar{D}_i} \geq c\} = \frac{\# I\{Y_{\bar{D}_i} \geq c\}}{\bar{n}_D}\]</span></p>
<p><u><strong>Ejemplo. (análogo al 2.6. así que ese no le incluyo.</strong></u></p>
<p>Supongamos que queremos estimar con el método empiricio la curva ROC asociada a un biomarcador y que se ha observado la siguiente muestra de resultados del biomarcador en sanos y enfermos.</p>
<p><span class="math inline">\(Y_{\overline{D}} = (1, 1, 2, 4, 4)\)</span><br><span class="math inline">\(Y_{D} = (2, 3, 4, 5, 7)\)</span></p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">Y_overD</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">Y_D</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">6</span>, <span class="fl">7</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Los valores observados se encuentran entre 2 y 7. <strong>Asigno c € (0.5, 7.5).</strong></p>
<p><span class="math inline">\(1 - \hat{Sp}(7.5) = \text{"proporcion de individuos sanos que tienen valores por encima de c = 7.5"} = 0\)</span></p>
<p><span class="math inline">\(1 - \hat{Sp}(7.5) = \text{"proporcion de individuos enfermos que tienen valores por encima de c = 7.5"} = 0\)</span></p>
<p>Sea <span class="math inline">\(c=6\)</span> el umbral de positivos,</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># sensibilidad</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">Y_D</span> <span class="op">&gt;=</span> <span class="fl">6</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">Y_D</span><span class="op">)</span></span>
<span><span class="co">## [1] 0.4</span></span>
<span><span class="co"># especificidad</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">Y_overD</span> <span class="op">&lt;</span> <span class="fl">6</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">Y_overD</span><span class="op">)</span></span>
<span><span class="co">## [1] 1</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>c<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/double.html">double</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                 `1-Sp`<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/double.html">double</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>                 Se<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/double.html">double</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">c</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">7.5</span>, <span class="fl">0.5</span>, by<span class="op">=</span><span class="op">-</span><span class="fl">0.5</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">se</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">Y_D</span> <span class="op">&gt;</span> <span class="va">c</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">Y_D</span><span class="op">)</span></span>
<span>  <span class="va">sp</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">Y_overD</span> <span class="op">&lt;</span> <span class="va">c</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">Y_overD</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">df</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">c</span>,<span class="va">sp</span>,<span class="va">se</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'c'</span>, <span class="st">'1-Sp(c)^'</span>, <span class="st">'Se(c)^'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">`1-Sp(c)^`</span>, y <span class="op">=</span> <span class="va">`Se(c)^`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"red"</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"red"</span>, size <span class="op">=</span> <span class="fl">1</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># Agrega líneas para unir los puntos</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_abline</a></span><span class="op">(</span>intercept <span class="op">=</span> <span class="fl">0</span>, slope <span class="op">=</span> <span class="fl">1</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"gray"</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_fixed</a></span><span class="op">(</span>ratio <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"ESTIMACIÓN DE LA CURVA ROC"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"1 - Especificidad (Tasa de Falsos Positivos)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Sensibilidad (Tasa de Verdaderos Positivos)"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="tema_02_3_curvas_roc_II_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Ordenada la muestra de mayor a menor, tenemos saltos horizontales de longitud proporcional a la inversa del tamaño muestral de sanos y saltos verticales de longitud proporcional a la inversa del tamaño muestral de enfermos.</p>
<p><strong>¿Dónde la distancia vertical es máxima?</strong> En (0, 2/5) <span class="math inline">\(\rightarrow\)</span> Esto es la estiamcion del índice de Youden.</p>
<p>¿a qué corresponde esa poligonal? a los empates. ¿eing?</p>
<p>Si miras la teoria que hay detras de todo esto pues ves que esas cosas dependen de los empates.</p>
<p>el AUC estimado es 0.78, sacado a mano sumando el área de los polígonos del dibujo.</p>
<p>¿Los valores observados están en algún sitio en la curva? Nop, la curva no representa los valores (si en lugar de números hubieran sido letras ordenadas alfabéticamente hubiera sido el mismo resultado). <strong>Solo es necesario saber el orden de los valores y saber si los valores se repiten.</strong> Ni los valores ni el punto del corte a partir del cual decimos que está enfermo se ven reflejados en la curva ROC.</p>
<p><strong>La curva ROC nos refleja a nivel global cómo se comporta el biomarcador pero no indica nada sobre si discrimina bien o no. Para ver si discrimina bien o no se tiene que mirar el AUC.</strong> (cuanto más cercano a 1 mejor sirve para discriminar)</p>
<p><span class="math display">\[
\widehat{\text{ROC}}(\cdot) = \left\{ (1 - \widehat{\text{Sp}}(c), \widehat{\text{Se}}(c)), \, \forall c \in (-\infty, +\infty) \right\} = \left\{ (t, \widehat{\text{ROC}}(t)), \, t \in (0,1) \right\},
\]</span></p>
<p><span class="math display">\[
\widehat{\text{ROC}}(t) = \widehat{S}_D \left( \widehat{S}_{\bar{D}}^{-1}(t) \right),
\]</span></p>
<p>Donde <span class="math inline">\(\widehat{S}_D\)</span> y <span class="math inline">\(\widehat{S}_{\bar{D}}\)</span> son las funciones de supervivencia empíricas.</p>
<p>La curva ROC empírica es una función escalonada creciente que se aproxima a la curva ROC teórica.</p>
<p><u><strong>Índices o medidas resumen.</strong></u></p>
<p><span class="math inline">\(\widehat{\text{AUC}} = \int_0^1 \widehat{\text{ROC}}(t) \, dt = \frac{1}{n_D \bar{n}_D} \sum_{j=1}^{\bar{n}_D} \sum_{i=1}^{n_D} \left\{ I[Y_{D_i} &gt; Y_{\bar{D}_j}] + \frac{1}{2} I[Y_{D_i} = Y_{\bar{D}_j}] \right\}\)</span></p>
<p><span class="math inline">\(\widehat{pAUC}(t_0) = \int_0^{t_0} \widehat{\text{ROC}}(t) \, dt\)</span></p>
<p><span class="math inline">\(\widehat{YI} = \max \left| \widehat{ROC}(t) - t \right| = \max \left| \widehat{Se} + \widehat{\text{Sp}} - 1 \right|\)</span></p>
<p><u><strong>Ejemplo.</strong></u></p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">602</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">Ysan3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html">rgamma</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">10</span>, <span class="fl">3</span><span class="op">)</span>, digits<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">Yenf3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html">rgamma</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">12</span>, <span class="fl">3</span><span class="op">)</span>, digits<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">roc3</span> <span class="op">&lt;-</span> <span class="fu">pROC</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pROC/man/roc.html">roc</a></span><span class="op">(</span>controls <span class="op">=</span> <span class="va">Ysan3</span>, cases <span class="op">=</span> <span class="va">Yenf3</span>, partial.auc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">roc3</span> <span class="co"># pos se supone que debería dar 0.686</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
roc.default(controls = Ysan3, cases = Yenf3, partial.auc = c(0,     0.2))

Data: 100 controls &lt; 100 cases.
Partial area under the curve (specificity 0.2-0): 0.197</code></pre>
</div>
</div>
<p>Cambiando la semilla, AKA cambiando la muestra, las estimaciones de AUC cambian. Aumentando el tamaño muestral obvio que también.</p>
<p><u><strong>Ejemplo 2.7.</strong></u></p>
<p>Se disponen de datos sobre las intensidades relativas de la expresión de un determinado gen para una muestra de 23 tejidos de ovarios sanos y para 30 de tejidos con tumor .</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span> <span class="op">(</span><span class="va"><a href="https://xrobin.github.io/pROC/">pROC</a></span><span class="op">)</span></span>
<span><span class="va">cancer</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"~/Master_Bioestadistica/Simulacion/tema_02/EjemploROCcancer.csv"</span>, header<span class="op">=</span><span class="cn">TRUE</span>, sep<span class="op">=</span><span class="st">";"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">roc1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pROC/man/roc.html">roc</a></span><span class="op">(</span><span class="va">cancer</span><span class="op">$</span><span class="va">var2</span>,<span class="va">cancer</span><span class="op">$</span><span class="va">var1</span>,plot<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="tema_02_3_curvas_roc_II_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#str(roc1)</span></span>
<span></span>
<span><span class="va">Youden</span> <span class="op">&lt;-</span> <span class="va">roc1</span><span class="op">$</span><span class="va">sensitivities</span><span class="op">+</span><span class="va">roc1</span><span class="op">$</span><span class="va">specificities</span><span class="op">-</span><span class="fl">1</span></span>
<span><span class="va">Youden</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">Youden</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">Youden</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.0000  0.1431  0.3297  0.2977  0.4453  0.5696 </code></pre>
</div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">YI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">Youden</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/pROC/man/plot.roc.html">plot.roc</a></span><span class="op">(</span><span class="va">roc1</span>,print.auc <span class="op">=</span> <span class="cn">TRUE</span>, legacy.axes <span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="tema_02_3_curvas_roc_II_files/figure-html/unnamed-chunk-11-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><u><strong>Ejemplo 2.8.</strong></u></p>
<p>¿Es el porcentaje de protombina un buen marcador de cirrosis? Los datos disponibles corresponden a una muestra de 145 individuos sanos y 39 cirróticos.</p>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span> <span class="op">(</span><span class="va"><a href="https://xrobin.github.io/pROC/">pROC</a></span><span class="op">)</span></span>
<span><span class="va">cirroticos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"~/Master_Bioestadistica/Simulacion/tema_02/Protom_SanCirr.csv"</span>, header<span class="op">=</span><span class="cn">TRUE</span>, sep<span class="op">=</span><span class="st">";"</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Representamos histogramas y distribuciones de densidad de los datos muestrales para hacernos una idea de si vamos a tener un biomarcador que nos ayude a discriminar o no.</p>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">densidad_cirroticos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/density.html">density</a></span><span class="op">(</span><span class="va">cirroticos</span><span class="op">$</span><span class="va">X.protombina</span><span class="op">[</span><span class="va">cirroticos</span><span class="op">$</span><span class="va">cirroticos.sanos</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">densidad_sanos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/density.html">density</a></span><span class="op">(</span><span class="va">cirroticos</span><span class="op">$</span><span class="va">X.protombina</span><span class="op">[</span><span class="va">cirroticos</span><span class="op">$</span><span class="va">cirroticos.sanos</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">densidad_cirroticos</span>, </span>
<span>     main <span class="op">=</span> <span class="st">"Distribuciones de densidad de X.protombina"</span>, </span>
<span>     xlab <span class="op">=</span> <span class="st">"X.protombina"</span>, </span>
<span>     ylab <span class="op">=</span> <span class="st">"Densidad"</span>, </span>
<span>     col <span class="op">=</span> <span class="st">"blue"</span>, </span>
<span>     lwd <span class="op">=</span> <span class="fl">2</span>, </span>
<span>     ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">densidad_cirroticos</span><span class="op">$</span><span class="va">y</span>, <span class="va">densidad_sanos</span><span class="op">$</span><span class="va">y</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">densidad_sanos</span>, col <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Cirróticos"</span>, <span class="st">"Sanos"</span><span class="op">)</span>, </span>
<span>       col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"red"</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="tema_02_3_curvas_roc_II_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#Ref: Estimación no paramétrica de la función de densidad. Antonio Miñarro 1998</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Aparentemente los sanos tienen valores superiores a los cirróticos y esto es al revés que muchos default. Intercambaimos los valores de casos y controles.</p>
<p>Los “casos” siempre son los que tienen mayor valor, en este caso los “casos” son los sanos.</p>
<p>Me parecía poco intuitivo ese valor del área bajo la curva (ROC) al observar cómo se solapan las distribuciones. Sin embargo, es cierto que lo que realmente se solapan son los rangos en los que se distribuyen los datos. Por debajo del punto donde las distribuciones se cruzan, la densidad de los datos en el grupo de los sanos es muy baja.</p>
</section><section id="suavizado-tipo-núcleo" class="level3"><h3 class="anchored" data-anchor-id="suavizado-tipo-núcleo">Suavizado tipo núcleo</h3>
<p>Ha dicho algo de nucleos y suavizado.</p>
<p>La curva ROC empírica es una función escalonada a pesar de que la curva ROC es continua. Además, parece razonable construir estimadores que también sean continuos. Estos se pueden obtener de forma no paramétrica mediante técnicas de suavización, por ejemplo de tipo núcleo:</p>
<p><span class="math display">\[
F_{D, h_D}(y) = \frac{1}{n_D} \sum_{i=1}^{n_D} K \left( \frac{y - y_{D_i}}{h_D} \right)
\]</span></p>
<p><span class="math display">\[
F_{\bar{D}, h_{\bar{D}}}(y) = \frac{1}{n_{\bar{D}}} \sum_{i=1}^{n_{\bar{D}}} K \left( \frac{y - y_{\bar{D}_i}}{h_{\bar{D}}} \right)
\]</span></p>
<p>donde <span class="math inline">\(F_D\)</span> y <span class="math inline">\(F_{\bar{D}}\)</span> son las funciones de distribución de enfermos y sanos, y <span class="math inline">\(K(t) = \int_{-\infty}^t k(u) \, du\)</span> es la función kernel.</p>
<p><span class="math display">\[
\widehat{\text{ROC}}(t) = 1 - F_{D, h_D} \left( F_{\bar{D}, h_{\bar{D}}}^{-1} (1 - t) \right), \quad t \in (0, 1).
\]</span></p>
<p>En R nos deja elegir el nucleo pero no la ventana. la ventana tiene aplicacion en diagnostico por imagen</p>
<p>Existen varios métodos para el suavizado.</p>
<ul>
<li><p>Binormal. Se utiliza una aproximación normal para la densidad de los datos. La curva ROC se estima bajo la suposición de que los datos provienen de distribuciones normales (binormalidad), con medias y varianzas estimadas a partir de la muestra.</p></li>
<li><p>Densidad. Se estima la densidad de los datos utilizando un núcleo considerado adecuado. Aunque se ha mencionado que es “perfecto”, no queda claro a qué se refiere exactamente dicha afirmación.</p></li>
<li><p>Best-Fit Distribution. Es la distribución que mejor se ajusta a los datos, determinada mediante el método de máxima verosimilitud.</p></li>
<li><p>lognormal: …</p></li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org">readr</a></span><span class="op">)</span></span>
<span><span class="va">datos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_delim</a></span><span class="op">(</span><span class="st">"Protom_SanCirr.csv"</span>, delim <span class="op">=</span> <span class="st">";"</span>, escape_double <span class="op">=</span> <span class="cn">FALSE</span>, trim_ws <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">roc1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pROC/man/roc.html">roc</a></span><span class="op">(</span><span class="va">datos</span><span class="op">$</span><span class="va">`cirroticos/sanos`</span>,<span class="va">datos</span><span class="op">$</span><span class="va">`%protombina`</span><span class="op">)</span></span>
<span><span class="co">#str(roc1)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">roc1</span>,legacy.axes <span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rs1</span> <span class="op">&lt;-</span> <span class="fu">smooth</span><span class="op">(</span><span class="va">roc1</span>, method<span class="op">=</span><span class="st">"binormal"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">rs1</span>, add<span class="op">=</span><span class="cn">TRUE</span>, col<span class="op">=</span><span class="st">"green"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rs2</span> <span class="op">&lt;-</span> <span class="fu">smooth</span><span class="op">(</span><span class="va">roc1</span>, method<span class="op">=</span> <span class="st">"density"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">rs2</span>, add<span class="op">=</span><span class="cn">TRUE</span>, col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rs3</span> <span class="op">&lt;-</span> <span class="fu">smooth</span><span class="op">(</span><span class="va">roc1</span>, method<span class="op">=</span><span class="st">"fitdistr"</span>, density<span class="op">=</span><span class="st">"lognormal"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">rs3</span>, add<span class="op">=</span><span class="cn">TRUE</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">"bottomright"</span>, legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Empírica"</span>,<span class="st">"Binormal"</span>,<span class="st">"Densidad"</span>,<span class="st">"Lognormal"</span><span class="op">)</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"black"</span>,<span class="st">"green"</span>,<span class="st">"blue"</span>,<span class="st">"red"</span><span class="op">)</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="tema_02_3_curvas_roc_II_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>El AUC es el mismo porque se estima utilizando la distribución empírica. La versión normalizada se emplea únicamente para representar gráficamente la curva ROC, ya que proporciona una visualización <strong>más intuitiva</strong>. Lo que hace es trazar la curva de manera más “estética”, generando una forma <strong>más continua y suave</strong>, en contraste con la versión empírica, que tiende a ser más <strong>poligonal y escalonada</strong>.</p>
</section></section><section id="intervalos-y-bandas-de-confianza" class="level2"><h2 class="anchored" data-anchor-id="intervalos-y-bandas-de-confianza">Intervalos y bandas de confianza</h2>
<p>La variabilidad muestral para la curva ROC empírica puede obtenerse desde varios puntos de vista:</p>
<ul>
<li><p>Fijando el punto de corte (<span class="math inline">\(c\)</span>) y obtener la variabilidad en el correspondiente punto de la curva ROC, <span class="math inline">\((1-\widehat{Sp}(c), \; \widehat{Se})\)</span>.(Regiones de confianza en los tests binarios)</p></li>
<li><p>Fijando la especificidad o fijando <span class="math inline">\(1-Sp\)</span> (<span class="math inline">\(t\)</span>) y considerar la variabilidad de <span class="math inline">\(\widehat{ROC}(t)\)</span> que ocurre en la dirección vertical.</p></li>
<li><p>Fijando la sensibilidad y obtener la variabilidad en la dirección horizontal.</p></li>
<li><p>Considerar la curva entera y cuantificar la variabilidad a través de bandas de confianza.</p></li>
</ul>
<p>Cuando la muestra es pequeña, solo es posible “repetir el experimento” utilizando el método bootstrap, generando nuevas muestras (tengo muestas de sanos y de enfermos) de igual tamaño que las originales, respetando la proporción entre los grupos de sanos y enfermos.</p>
<p>Fijado, se puede calcular la sensibilidad y la especificidad correspondientes para cada muestra bootstrap, lo que permite estimar una región de confianza para estos valores.</p>
<p>Si se mantiene fija una de las dimensiones (tanto la sensibilidad como la especificidad), es posible observar cómo varía la otra dimensión (en este caso, la especificidad) y determinar el rango en el que se encuentra, es decir, “fijada la sensibilidad, ver de qué punto a qué punto varía la especificidad”.</p>
<p>[aquí ha hecho un dibujito muy boniko que a ver si lo replico.]</p>
<p>La diferencia entre las bandas de confianza obtenidas mediante el método bootstrap y las obtenidas a través de la aproximación asintótica es muy pequeña.</p>
<section id="intervalos-de-confianza-para-las-medidas-resumen" class="level4"><h4 class="anchored" data-anchor-id="intervalos-de-confianza-para-las-medidas-resumen">Intervalos de confianza para las medidas resumen</h4>
<p>Suelen obtenerse utilizando bootstrap.</p>
<p>Se tienen expresiones analíticas para la varianza asintótica del <span class="math inline">\(\widehat{AUC}\)</span> empírico. Para muestras grandes:</p>
<p><span class="math display">\[IC_{1-\alpha} (\text{logit} \widehat{\text{AUC}}) = \log \left( \frac{\widehat{\text{AUC}}}{1 - \widehat{\text{AUC}}} \right) + z_{\alpha/2} \sqrt{\frac{\widehat{\text{Var}} (\widehat{\text{AUC}})}{\widehat{\text{AUC}} (1 - \widehat{\text{AUC}})}}\]</span></p>
<p><span class="math display">\[\widehat{\text{Var}} (\widehat{\text{AUC}}) = \frac{\widehat{\text{Var}} (\widehat{S}_{\overline{D}} (Y_{D_i}))}{n_D} + \frac{\widehat{\text{Var}} (\widehat{S}_{D} (Y_{\overline{D}_j}))}{n_{\overline{D}}}\]</span></p>
<p>Donde <span class="math inline">\(\widehat{Var}\)</span> denota las varianzas muestrales de los valores empíricos correspondientes.</p>
<p><u><strong>Ejemplo 2.8.</strong></u></p>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span> <span class="op">(</span><span class="va"><a href="https://xrobin.github.io/pROC/">pROC</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">roc1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pROC/man/roc.html">roc</a></span><span class="op">(</span><span class="va">cancer</span><span class="op">$</span><span class="va">var2</span>,<span class="va">cancer</span><span class="op">$</span><span class="va">var1</span>,plot<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="tema_02_3_curvas_roc_II_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>pty<span class="op">=</span><span class="st">"s"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">roc1</span>, legacy.axes <span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">banda</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pROC/man/ci.se.html">ci.se</a></span><span class="op">(</span><span class="va">roc1</span>, sp<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0.01</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">banda</span>, type <span class="op">=</span> <span class="st">"shape"</span>, col<span class="op">=</span><span class="st">"lightblue"</span><span class="op">)</span></span>
<span><span class="va">ICaucd</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pROC/man/ci.auc.html">ci.auc</a></span><span class="op">(</span><span class="va">roc1</span>, method<span class="op">=</span><span class="st">"d"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">ICaucd</span><span class="op">)</span></span>
<span><span class="co">## 95% CI: 0.6843-0.9331 (DeLong)</span></span>
<span></span>
<span><span class="va">ICaucb</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pROC/man/ci.auc.html">ci.auc</a></span><span class="op">(</span><span class="va">roc1</span>, method<span class="op">=</span><span class="st">"b"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">ICaucb</span><span class="op">)</span></span>
<span><span class="co">## 95% CI: 0.6826-0.9188 (2000 stratified bootstrap replicates)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">roc1</span><span class="op">$</span><span class="va">auc</span><span class="op">)</span></span>
<span><span class="co">## Area under the curve: 0.8087</span></span>
<span></span>
<span><span class="co"># IC fijada la especificidad en 0.8</span></span>
<span><span class="va">IC_Se80</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pROC/man/ci.se.html">ci.se</a></span><span class="op">(</span><span class="va">roc1</span>, sp<span class="op">=</span><span class="fl">0.8</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">IC_Se80</span><span class="op">)</span></span>
<span><span class="co">## 95% CI (2000 stratified bootstrap replicates):</span></span>
<span><span class="co">##   sp se.low se.median se.high</span></span>
<span><span class="co">##  0.8 0.3333    0.7333     0.9</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">IC_Se80</span>, col<span class="op">=</span><span class="st">"darkgreen"</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="tema_02_3_curvas_roc_II_files/figure-html/unnamed-chunk-16-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section></section><section id="comparación-de-curvas-roc" class="level2"><h2 class="anchored" data-anchor-id="comparación-de-curvas-roc">Comparación de curvas ROC</h2>
<ul>
<li><p>Las comparaciones pueden hacerse utilizando AUC, bandas de confianza, forma de la curva ROC, fijando una especificidad (o sensibilidad)… La más utilizada se basa en el AUC. (hay varios testsimplementados en R)</p></li>
<li><p>Curvas ROC pareadas: curvas estimadas con los mismos sujetos. Existen varios test para comparar curvas pareadas (Hanley and McNeil 1983, Delong et al.&nbsp;1988, Venkatraman and Begg 1996, Bandos et al.&nbsp;2005, Braun andAlonso 2008, …)</p></li>
<li><p>Curvas ROC no pareadas: curvas estimadas con diferentes sujetos. (Hanley and McNeil 1982, Venkatraman 2000, …)</p></li>
</ul>
<p>lleva emparejado dos biomarcadores en dos muestras pareaadas o no pareadas, dependiendo del tipo de muestras usaremos un tipo de comparación y otra.</p>
<p>El estimador que se suele usar es la diferencia de las AUC, normalizado para tener una distribucion asintotica.</p>
<p>Sean dos pruebas diagnósticas A, B y sean <span class="math inline">\(ROC_A\)</span> y <span class="math inline">\(ROC_B\)</span> sus respectivas cirvas ROC. Entonce, <span class="math inline">\(H0: ROC_A = ROC_B\)</span>.</p>
<p>El estadístico <span class="math inline">\(\frac{\Delta \widehat{\text{AUC}}}{\sqrt{\text{Var}(\Delta \widehat{\text{AUC}})}} \approx_{H_0} N(0,1)\)</span>, siendo <span class="math inline">\(\Delta \widehat{\text{AUC}} = \widehat{\text{AUC}}_A - \widehat{\text{AUC}}_B\)</span>.</p>
<section id="curvas-no-pareadas" class="level4"><h4 class="anchored" data-anchor-id="curvas-no-pareadas">Curvas no pareadas:</h4>
<p><span class="math inline">\(Var \Delta \widehat{AUC}) = Var(\widehat{AUC}_A) + Var(\widehat{AUC}_B)\)</span>.</p>
<p>(Los estimadores de estas varianzas ya los vimos previamente.)</p>
<p>Si las AUC son diferentes imploca tener curvas claramente distintas (al revés no tiene por qué cumplirse)</p>
<p><span class="math inline">\(\{ (Y_{D_i, A}, Y_{D_i, B}), \, i = 1, \ldots, n_D \}\)</span> para <span class="math inline">\(n_D\)</span> observaciones independientes de enfermos.</p>
<p><span class="math inline">\(\{ (Y_{\overline{D}_j, A}, Y_{\overline{D}_j, B}), \, j = 1, \ldots, n_{\overline{D}}\)</span> para <span class="math inline">\(n_{\overline{D}}\)</span> observaciones independientes de sanos.</p>
<p>En muestras grandes: <span class="math inline">\(Var(\Delta \widehat{\text{AUC}}) \approx \frac{\text{Var}(S_{\overline{D}, A}(Y_{D, A}) - S_{D, B}(Y_{D, B}))}{n_D} + \frac{\text{Var}(S_{D, A}(Y_{\overline{D}, A}) - S_{D, B}(Y_{\overline{D},B}))}{n_{\overline{D}}}\)</span></p>
<p>Varianza estimada por: <span class="math inline">\(\frac{\widehat{\text{Var}}(\widehat{S}_{\overline{D}, A}(Y_{D, A}) - \widehat{S}_{\overline{D}, B}(Y_{D, B}))}{n_D} + \frac{\widehat{\text{Var}}(\widehat{S}_{D, A}(Y_{\overline{D}, A}) - \widehat{S}_{D, B}(Y_{\overline{D}, B}))}{n_{\overline{D}}}\)</span>.</p>
<p>Probabilidad acumulada: densidad.<br>
Probabilidad de colas: probabilidad de supervivencia.</p>
<p><u><strong>Ejemplo 2.9.</strong></u></p>
<p>El paquete pROC contiene una base de datos (aSAH) de 141 pacientes con hemorragia subaracnoide aneurísmica (“aneurysmal subarachnoid hemorrhage”). Queremos comparar los biomarcadores s100b y wfns.</p>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">aSAH</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## 'data.frame':    113 obs. of  7 variables:</span></span>
<span><span class="co">##  $ gos6   : Ord.factor w/ 5 levels "1"&lt;"2"&lt;"3"&lt;"4"&lt;..: 5 5 5 5 1 1 4 1 5 4 ...</span></span>
<span><span class="co">##  $ outcome: Factor w/ 2 levels "Good","Poor": 1 1 1 1 2 2 1 2 1 1 ...</span></span>
<span><span class="co">##  $ gender : Factor w/ 2 levels "Male","Female": 2 2 2 2 2 1 1 1 2 2 ...</span></span>
<span><span class="co">##  $ age    : int  42 37 42 27 42 48 57 41 49 75 ...</span></span>
<span><span class="co">##  $ wfns   : Ord.factor w/ 5 levels "1"&lt;"2"&lt;"3"&lt;"4"&lt;..: 1 1 1 1 3 2 5 4 1 2 ...</span></span>
<span><span class="co">##  $ s100b  : num  0.13 0.14 0.1 0.04 0.13 0.1 0.47 0.16 0.18 0.1 ...</span></span>
<span><span class="co">##  $ ndka   : num  3.01 8.54 8.09 10.42 17.4 ...</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">roc_wfns</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pROC/man/roc.html">roc</a></span><span class="op">(</span><span class="va">aSAH</span><span class="op">$</span><span class="va">outcome</span>, <span class="va">aSAH</span><span class="op">$</span><span class="va">wfns</span>, plot<span class="op">=</span><span class="cn">TRUE</span>, print.auc <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>; <span class="co"># str(roc_wfns)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="tema_02_3_curvas_roc_II_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">Youden</span> <span class="op">&lt;-</span> <span class="va">roc_wfns</span><span class="op">$</span><span class="va">sensitivities</span> <span class="op">+</span> <span class="va">roc_wfns</span><span class="op">$</span><span class="va">specificities</span> <span class="op">-</span> <span class="fl">1</span></span>
<span><span class="va">Youden</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">Youden</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">Youden</span><span class="op">)</span></span>
<span><span class="co">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span><span class="co">## 0.00000 0.09587 0.41684 0.29438 0.46138 0.46748</span></span>
<span></span>
<span><span class="op">(</span><span class="va">YI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">Youden</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## [1] 0.4674797</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">roc_s100b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pROC/man/roc.html">roc</a></span><span class="op">(</span><span class="va">aSAH</span><span class="op">$</span><span class="va">outcome</span>, <span class="va">aSAH</span><span class="op">$</span><span class="va">s100b</span>, plot<span class="op">=</span><span class="cn">TRUE</span>, print.auc <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>; <span class="co"># str(roc_s100b)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="tema_02_3_curvas_roc_II_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">Youden</span> <span class="op">&lt;-</span> <span class="va">roc_s100b</span><span class="op">$</span><span class="va">sensitivities</span> <span class="op">+</span> <span class="va">roc_s100b</span><span class="op">$</span><span class="va">specificities</span> <span class="op">-</span> <span class="fl">1</span></span>
<span><span class="va">Youden</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">Youden</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">Youden</span><span class="op">)</span></span>
<span><span class="co">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span><span class="co">##  0.0000  0.1650  0.2734  0.2464  0.3176  0.4397</span></span>
<span></span>
<span><span class="op">(</span><span class="va">YI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">Youden</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## [1] 0.4397019</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">roc_wfns</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">roc_s100b</span>, add<span class="op">=</span><span class="cn">TRUE</span>, col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">"bottomright"</span>, legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"s100b"</span>,<span class="st">"wfns"</span><span class="op">)</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"red"</span>,<span class="st">"blue"</span><span class="op">)</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="tema_02_3_curvas_roc_II_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>A parte de comparar los resultados de las curvas ROC es necesario saber si se pueden considerar iguales o no.</p>
<p>Al comparar dos curvas, podemos determinar si son diferentes a partir del p-valor asociado a la hipótesis nula en un tipo de test. Si este p-valor es menor que el nivel de significancia que hayamos definido, concluimos que las curvas no son iguales. Por ejemplo, usando el método de DeLong, el cálculo del estadístico y su distribución asintótica son diferentes, pero llegamos a la misma conclusión. Lo mismo sucede con el método de Venkatraman: aunque el enfoque cambia, el resultado final es consistente.</p>
<p>Comparación de las curvas ROC pareadas usando el test de Delong (por defecto).</p>
<div class="cell">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/pROC/man/roc.test.html">roc.test</a></span><span class="op">(</span><span class="va">roc_wfns</span>, <span class="va">roc_wfns</span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  DeLong's test for two correlated ROC curves</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## data:  roc_wfns and roc_wfns</span></span>
<span><span class="co">## Z = 0, p-value = 1</span></span>
<span><span class="co">## alternative hypothesis: true difference in AUC is not equal to 0</span></span>
<span><span class="co">## 95 percent confidence interval:</span></span>
<span><span class="co">##  0 0</span></span>
<span><span class="co">## sample estimates:</span></span>
<span><span class="co">## AUC of roc1 AUC of roc2 </span></span>
<span><span class="co">##   0.8236789   0.8236789</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Comparación de las curvas ROC pareadas usando bootstrap.</p>
<div class="cell">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/pROC/man/roc.test.html">roc.test</a></span><span class="op">(</span><span class="va">roc_wfns</span>, <span class="va">roc_wfns</span>, method<span class="op">=</span><span class="st">"bootstrap"</span>, boot.n<span class="op">=</span><span class="fl">1000</span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  Bootstrap test for two correlated ROC curves</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## data:  roc_wfns and roc_wfns</span></span>
<span><span class="co">## D = 0, boot.n = 1000, boot.stratified = 1, p-value = 1</span></span>
<span><span class="co">## alternative hypothesis: true difference in AUC is not equal to 0</span></span>
<span><span class="co">## sample estimates:</span></span>
<span><span class="co">## AUC of roc1 AUC of roc2 </span></span>
<span><span class="co">##   0.8236789   0.8236789</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Comparación de las curvas ROC pareadas usando el test de Venkatraman.</p>
<div class="cell">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/pROC/man/roc.test.html">roc.test</a></span><span class="op">(</span><span class="va">roc_wfns</span>, <span class="va">roc_s100b</span>, method <span class="op">=</span> <span class="st">'venkatraman'</span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  Venkatraman's test for two paired ROC curves</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## data:  roc_wfns and roc_s100b</span></span>
<span><span class="co">## E = 578, boot.n = 2000, p-value = 0.0205</span></span>
<span><span class="co">## alternative hypothesis: true difference in at least one ROC operating point is not equal to 0</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Comparación de las curvas ROC pareadas fijando la especificidad.</p>
<div class="cell">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/pROC/man/roc.test.html">roc.test</a></span><span class="op">(</span><span class="va">roc_wfns</span>, <span class="va">roc_s100b</span>, method<span class="op">=</span><span class="st">"specificity"</span>, specificity<span class="op">=</span><span class="fl">0.9</span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  Specificity test for two correlated ROC curves</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## data:  roc_wfns and roc_s100b</span></span>
<span><span class="co">## D = 1.3199, boot.n = 2000, boot.stratified = 1, p-value = 0.1869</span></span>
<span><span class="co">## alternative hypothesis: true difference in sensitivity at 0.9 specificity is not equal to 0</span></span>
<span><span class="co">## sample estimates:</span></span>
<span><span class="co">## AUC of roc1 AUC of roc2 </span></span>
<span><span class="co">##   0.8236789   0.7313686</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Cuando fijamos una especificidad de 0.9, contrastamos si las sensibilidades de las dos pruebas son iguales (<span class="math inline">\(Se_A = Se_B\)</span>). Con un p-valor de 0.2034, aceptamos la hipótesis nula, lo que implica que no tenemos evidencia suficiente para afirmar que las sensibilidades son diferentes a ese nivel de especificidad.</p>
<p>Comparación de las curvas ROC pareadas fijando la sensibilidad.</p>
<div class="cell">
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/pROC/man/roc.test.html">roc.test</a></span><span class="op">(</span><span class="va">roc_wfns</span>, <span class="va">roc_s100b</span>, method<span class="op">=</span><span class="st">"sensitivity"</span>, sensitivity<span class="op">=</span><span class="fl">0.9</span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  Sensitivity test for two correlated ROC curves</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## data:  roc_wfns and roc_s100b</span></span>
<span><span class="co">## D = 3.2347, boot.n = 2000, boot.stratified = 1, p-value = 0.001218</span></span>
<span><span class="co">## alternative hypothesis: true difference in specificity at 0.9 sensitivity is not equal to 0</span></span>
<span><span class="co">## sample estimates:</span></span>
<span><span class="co">## AUC of roc1 AUC of roc2 </span></span>
<span><span class="co">##   0.8236789   0.7313686</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>En un segundo análisis, fijamos la sensibilidad en 0.9 y contrastamos si las especificidades de las dos pruebas coinciden. En este caso, obtenemos un p-valor &lt; 0.001, lo que nos permite descartar la hipótesis nula y concluir que las especificidades no son iguales.</p>
<p>Estos resultados se respaldan tanto por los tests estadísticos como por el marco teórico que garantiza su validez. Sin embargo, también es útil obtener una primera impresión visual observando las curvas ROC.</p>
<p>“Curiosamente”, la especificidad de 0.9 coincide con el punto donde las curvas ROC se cruzan. Por eso, a ese nivel de especificidad, no se pueden diferenciar las sensibilidades.</p>
<p>¿Para una especificidad de 0.9, las dos pruebas tienen sensibilidades distintas?</p>
<p>Parece que no, ya que el p-valor es 0.2, lo que indica que no hay evidencia suficiente para concluir que las sensibilidades de las dos pruebas son diferentes cuando se fija una especificidad de 0.9.</p>
<p>Sin embargo, si aplico bootstrap haciendo el análisis al revés (fijando la sensibilidad en 0.9), el resultado cambia: no puedo aceptar que las dos pruebas tengan la misma especificidad en este caso.</p>
<p>No existe evidencia suficiente para afirmar que, con una especificidad de 0.9, las dos sensibilidades son iguales.</p>
</section></section><section id="elección-del-punto-de-corte-c" class="level2"><h2 class="anchored" data-anchor-id="elección-del-punto-de-corte-c">Elección del punto de corte c</h2>
<p>Valor que determina que la prueba diagnóstica asigne como positivo o negativo un resultado de la prueba. Este valor es elegido bajo un tipo de criterio.</p>
<p>Tener una estimacion del AUC, y sobre todo su IC, nos da una pista para decidir qué tipo de prueba tenemos.</p>
<table class="table">
<colgroup>
<col style="width: 11%">
<col style="width: 15%">
<col style="width: 72%">
</colgroup>
<thead><tr class="header">
<th><strong>AUC</strong></th>
<th><strong>Categoría</strong></th>
<th><strong>Explicación</strong></th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>&lt; 0.6</strong></td>
<td>Prueba no útil</td>
<td>“Con un AUC de 0.55, la prueba tiene un rendimiento inferior al azar, lo que sugiere que no es adecuada para diferenciar entre pacientes con la condición y aquellos sin ella. En este caso, podría no justificar el uso de este test en la práctica clínica.”</td>
</tr>
<tr class="even">
<td><strong>0.7 - 0.8</strong></td>
<td>Buena</td>
<td>“El AUC de 0.75 indica que la prueba tiene una capacidad razonablemente buena para distinguir entre los pacientes con la enfermedad y aquellos sin ella, pero aún existe un margen de mejora. Sería adecuado usarla, aunque se debe considerar si otros tests podrían ser más eficaces.”</td>
</tr>
<tr class="odd">
<td><strong>0.8 - 0.9</strong></td>
<td>Muy buena</td>
<td>“Con un AUC de 0.85, esta prueba muestra una excelente capacidad para identificar a los pacientes con la enfermedad. Esto sugiere que podría ser un test de gran valor para el diagnóstico, especialmente cuando se requiere alta precisión en la identificación de casos positivos.”</td>
</tr>
<tr class="even">
<td><strong>0.9 - 1</strong></td>
<td>Excelente</td>
<td>“Un AUC de 0.95 indica que la prueba tiene una capacidad excelente para diferenciar entre los pacientes con y sin la enfermedad. Este resultado sugiere que podríamos considerar esta prueba como un estándar en la práctica clínica para asegurar una detección precisa y temprana.”</td>
</tr>
</tbody>
</table>
<p>En casos donde <span class="math inline">\(\widehat{AUC}\)</span> junto con sus intervalos del IC es claramente menor a 0.6 podemos obviar esa curva ROC y no es necesario hacer ninguna comparativa con otra.</p>
<section id="criterios-de-elección" class="level4"><h4 class="anchored" data-anchor-id="criterios-de-elección">Criterios de elección</h4>
<ul>
<li><p>Índice de Youden. Elegimos <span class="math inline">\(c :\max ( YI(c) = Se(c) + Sp(c) - 1 )\)</span></p></li>
<li><p>Igual sensibilidad que especificidad.</p></li>
<li><p>Maximizar la sensibilidad o la especificidad.</p></li>
<li><p>Maximizar el índice de Unión. <span class="math inline">\(IU(c)=|Se(c)-AUC|+|Sp(c)-AUC|\)</span></p></li>
<li><p>Maximizar el índice de Liu: <span class="math inline">\(IL(c)=|Se(c)-AUC|+|Sp(c)-AUC|\)</span></p></li>
</ul>
<p>Todas las estrategias se centran en maximizar tanto la sensibilidad como la especificidad dentro de los límites que ofrece la prueba. Si la sensibilidad no supera un valor <em>x</em>, por más que intentemos optimizarla, no lograremos un aumento significativo.</p>
<p><u><strong>Ejemplo 2.10.</strong></u></p>
<p>El paquete Optimal Cutpoints contiene la base de datos elas (Leukocyte Elastase) con 141 observaciones correspondientes a las variables elas, status y gender. Los datos corresponden a un estudio llevado a cabo para evaluar la utilidad de la elastasa leucocitaria en la diagnosis de la enfermedad arterial coronaria (CAD). Elegimos el punto de corte tal que maximice el índice de Youden y el punto de corte que iguale sensibilidad y especificidad.</p>
<div class="cell">
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">OptimalCutpoints</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">elas</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">elas</span><span class="op">)</span></span>
<span><span class="co">##       elas            status          gender   </span></span>
<span><span class="co">##  Min.   :  5.00   Min.   :0.0000   Female: 37  </span></span>
<span><span class="co">##  1st Qu.: 27.00   1st Qu.:0.0000   Male  :104  </span></span>
<span><span class="co">##  Median : 39.00   Median :1.0000               </span></span>
<span><span class="co">##  Mean   : 43.28   Mean   :0.6809               </span></span>
<span><span class="co">##  3rd Qu.: 51.00   3rd Qu.:1.0000               </span></span>
<span><span class="co">##  Max.   :163.00   Max.   :1.0000</span></span>
<span></span>
<span><span class="va">pcorte_Youden</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/OptimalCutpoints/man/optimal.cutpoints.html">optimal.cutpoints</a></span><span class="op">(</span>X <span class="op">=</span> <span class="st">"elas"</span>, status <span class="op">=</span> <span class="st">"status"</span>, tag.healthy<span class="op">=</span> <span class="fl">0</span>, methods<span class="op">=</span> <span class="st">"Youden"</span>, data <span class="op">=</span> <span class="va">elas</span>, pop.prev<span class="op">=</span> <span class="cn">NULL</span>, ci.fit <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">pcorte_Youden</span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## optimal.cutpoints.default(X = "elas", status = "status", tag.healthy = 0, </span></span>
<span><span class="co">##     methods = "Youden", data = elas, pop.prev = NULL, ci.fit = TRUE)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Area under the ROC curve (AUC):  0.744 (0.659, 0.828) </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## CRITERION: Youden</span></span>
<span><span class="co">## Number of optimal cutoffs: 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##                     Estimate 95% CI lower limit 95% CI upper limit</span></span>
<span><span class="co">## cutoff            37.0000000                  -                  -</span></span>
<span><span class="co">## Se                 0.6875000          0.5848184          0.7782474</span></span>
<span><span class="co">## Sp                 0.6666667          0.5104964          0.7999943</span></span>
<span><span class="co">## PPV                0.8148148          0.6964499          0.8752971</span></span>
<span><span class="co">## NPV                0.5000000          0.3903427          0.6666588</span></span>
<span><span class="co">## DLR.Positive       2.0625000          1.3354513          3.1853698</span></span>
<span><span class="co">## DLR.Negative       0.4687500          0.3265302          0.6729134</span></span>
<span><span class="co">## FP                15.0000000                  -                  -</span></span>
<span><span class="co">## FN                30.0000000                  -                  -</span></span>
<span><span class="co">## Optimal criterion  0.3541667                  -                  -</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">pcorte_Youden</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="tema_02_3_curvas_roc_II_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" width="672"></p>
</div>
<pre><code>## Press return for next page....</code></pre>
<div class="cell-output-display">
<p><img src="tema_02_3_curvas_roc_II_files/figure-html/unnamed-chunk-28-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>¿La variable “elas” se distribuye de una forma similar en hombres que en mujeres? Dibujemos las densidades estimadas de “elas” para hombres y mujeres, distinguiendo sanos y enfermos.</p>
<p>Consideramos un resultado positivo cuando es mayor a 37, pero este punto de corte, por sí solo, no proporciona suficiente información sobre el desempeño de la prueba. Analizamos el AUC (Área Bajo la Curva) y obtuvimos un valor de 0.74. Este valor sugiere que no podemos descartar la prueba, ya que, según su intervalo de confianza (IC), en ocasiones puede considerarse aceptable.</p>
<p><strong>Interpretación del AUC</strong>: Asignando los valores más altos a los pacientes enfermos, se estima que la prueba acierta en el 74 % de los casos. No obstante, este porcentaje puede variar entre un 66 % y un 62 %, según el intervalo de confianza.</p>
<p>El porcentaje de acierto global de la prueba es del 68 %. Sin embargo, el intervalo de confianza (0.5848-0.7782) incluye valores cercanos al azar (0.5), lo cual indica un desempeño inconsistente. Aunque el límite superior del intervalo se acerca a un valor moderadamente bueno, está muy lejos del ideal (1.0). Esto sugiere que la prueba no es confiable.</p>
<p>Hubiera sido útil incluir un análisis descriptivo más detallado para contextualizar estos resultados.</p>
<p>Inicialmente, analizamos los datos agrupados, pero ahora hemos optado por separar los resultados según el sexo, distinguiendo entre hombres y mujeres.</p>
<div class="cell">
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Datos para mujeres</span></span>
<span><span class="va">datosmuj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">elas</span>, <span class="va">gender</span><span class="op">==</span><span class="st">"Female"</span><span class="op">)</span></span>
<span><span class="va">mujsana</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">datosmuj</span>, <span class="va">status</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">mujenf</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">datosmuj</span>, <span class="va">status</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Datos para hombres</span></span>
<span><span class="va">datoshom</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">elas</span>, <span class="va">gender</span><span class="op">==</span><span class="st">"Male"</span><span class="op">)</span></span>
<span><span class="va">homsano</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">datoshom</span>, <span class="va">status</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">homenf</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">datoshom</span>, <span class="va">status</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Densidades estimadas</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html">density</a></span><span class="op">(</span><span class="va">mujsana</span><span class="op">$</span><span class="va">elas</span>,na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>, lty<span class="op">=</span><span class="fl">2</span>, lwd<span class="op">=</span><span class="fl">2</span>, xlab<span class="op">=</span><span class="st">"elas"</span>, ylab<span class="op">=</span><span class="st">"Densidad"</span>,</span>
<span>     xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">180</span><span class="op">)</span>,ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.03</span><span class="op">)</span>, main<span class="op">=</span><span class="st">"Mujeres"</span>, type<span class="op">=</span><span class="st">"l"</span>, col<span class="op">=</span><span class="st">"darkblue"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html">density</a></span><span class="op">(</span><span class="va">mujenf</span><span class="op">$</span><span class="va">elas</span>,na.rm <span class="op">=</span><span class="cn">T</span><span class="op">)</span>, lty<span class="op">=</span><span class="fl">1</span>, lwd<span class="op">=</span><span class="fl">2</span>, xlab<span class="op">=</span><span class="st">""</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span><span class="fl">20</span>,<span class="fl">0.021</span>, <span class="st">"Sanos"</span>, col<span class="op">=</span><span class="st">"darkblue"</span>, adj<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="op">-</span><span class="fl">.1</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span><span class="fl">60</span>,<span class="fl">0.021</span>, <span class="st">"Enfermos"</span>, col<span class="op">=</span><span class="st">"red"</span>, adj<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="op">-</span><span class="fl">.1</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="tema_02_3_curvas_roc_II_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html">density</a></span><span class="op">(</span><span class="va">homsano</span><span class="op">$</span><span class="va">elas</span>,na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>, lty<span class="op">=</span><span class="fl">2</span>, lwd<span class="op">=</span><span class="fl">2</span>, xlab<span class="op">=</span><span class="st">"elas"</span>, ylab<span class="op">=</span><span class="st">"Densidad"</span>,</span>
<span>     xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">180</span><span class="op">)</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.03</span><span class="op">)</span>, main<span class="op">=</span><span class="st">"Hombres"</span>, type<span class="op">=</span><span class="st">"l"</span>, col<span class="op">=</span><span class="st">"darkblue"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html">density</a></span><span class="op">(</span><span class="va">homenf</span><span class="op">$</span><span class="va">elas</span>,na.rm <span class="op">=</span><span class="cn">T</span><span class="op">)</span>, lty<span class="op">=</span><span class="fl">1</span>,lwd<span class="op">=</span><span class="fl">2</span>, xlab<span class="op">=</span><span class="st">""</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span><span class="fl">65</span>,<span class="fl">0.025</span>, <span class="st">"Sanos"</span>, col<span class="op">=</span><span class="st">"darkblue"</span>, adj<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="op">-</span><span class="fl">.1</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span><span class="fl">75</span>,<span class="fl">0.02</span>, <span class="st">"Enfermos"</span>, col<span class="op">=</span><span class="st">"red"</span>, adj<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="op">-</span><span class="fl">.1</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="tema_02_3_curvas_roc_II_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">OptimalCutpoints</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pcorte_Youden</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/OptimalCutpoints/man/optimal.cutpoints.html">optimal.cutpoints</a></span><span class="op">(</span>X <span class="op">=</span> <span class="st">"elas"</span>, status <span class="op">=</span> <span class="st">"status"</span>, tag.healthy<span class="op">=</span> <span class="fl">0</span>, methods<span class="op">=</span> <span class="st">"Youden"</span>, data <span class="op">=</span> <span class="va">datosmuj</span>, pop.prev<span class="op">=</span> <span class="cn">NULL</span>, ci.fit <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">pcorte_Youden</span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## optimal.cutpoints.default(X = "elas", status = "status", tag.healthy = 0, </span></span>
<span><span class="co">##     methods = "Youden", data = datosmuj, pop.prev = NULL, ci.fit = TRUE)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Area under the ROC curve (AUC):  0.818 (0.684, 0.952) </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## CRITERION: Youden</span></span>
<span><span class="co">## Number of optimal cutoffs: 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##                     Estimate 95% CI lower limit 95% CI upper limit</span></span>
<span><span class="co">## cutoff            46.0000000                  -                  -</span></span>
<span><span class="co">## Se                 0.6666667          0.3838037          0.8817589</span></span>
<span><span class="co">## Sp                 0.8181818          0.5971542          0.9481327</span></span>
<span><span class="co">## PPV                0.7142857          0.4516107          0.9031160</span></span>
<span><span class="co">## NPV                0.7826087          0.5285570          0.9359958</span></span>
<span><span class="co">## DLR.Positive       3.6666667          1.4096667          9.5373214</span></span>
<span><span class="co">## DLR.Negative       0.4074074          0.1939348          0.8558589</span></span>
<span><span class="co">## FP                 4.0000000                  -                  -</span></span>
<span><span class="co">## FN                 5.0000000                  -                  -</span></span>
<span><span class="co">## Optimal criterion  0.4848485                  -                  -</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">pcorte_Youden</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="tema_02_3_curvas_roc_II_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid" width="672"></p>
</div>
<pre><code>## Press return for next page....</code></pre>
<div class="cell-output-display">
<p><img src="tema_02_3_curvas_roc_II_files/figure-html/unnamed-chunk-32-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">OptimalCutpoints</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pcorte_Youden</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/OptimalCutpoints/man/optimal.cutpoints.html">optimal.cutpoints</a></span><span class="op">(</span>X <span class="op">=</span> <span class="st">"elas"</span>, status <span class="op">=</span> <span class="st">"status"</span>, tag.healthy<span class="op">=</span> <span class="fl">0</span>, methods<span class="op">=</span> <span class="st">"Youden"</span>, data <span class="op">=</span> <span class="va">datoshom</span>, pop.prev<span class="op">=</span> <span class="cn">NULL</span>, ci.fit <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">pcorte_Youden</span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## optimal.cutpoints.default(X = "elas", status = "status", tag.healthy = 0, </span></span>
<span><span class="co">##     methods = "Youden", data = datoshom, pop.prev = NULL, ci.fit = TRUE)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Area under the ROC curve (AUC):  0.722 (0.612, 0.831) </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## CRITERION: Youden</span></span>
<span><span class="co">## Number of optimal cutoffs: 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##                     Estimate 95% CI lower limit 95% CI upper limit</span></span>
<span><span class="co">## cutoff            38.0000000                  -                  -</span></span>
<span><span class="co">## Se                 0.6543210          0.5404147          0.7565737</span></span>
<span><span class="co">## Sp                 0.7391304          0.5159480          0.8977139</span></span>
<span><span class="co">## PPV                0.8983051          0.7686835          0.9355009</span></span>
<span><span class="co">## NPV                0.3777778          0.2738718          0.6528595</span></span>
<span><span class="co">## DLR.Positive       2.5082305          1.2382379          5.0807845</span></span>
<span><span class="co">## DLR.Negative       0.4676834          0.3180320          0.6877538</span></span>
<span><span class="co">## FP                 6.0000000                  -                  -</span></span>
<span><span class="co">## FN                28.0000000                  -                  -</span></span>
<span><span class="co">## Optimal criterion  0.3934514                  -                  -</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">pcorte_Youden</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="tema_02_3_curvas_roc_II_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid" width="672"></p>
</div>
<pre><code>## Press return for next page....</code></pre>
<div class="cell-output-display">
<p><img src="tema_02_3_curvas_roc_II_files/figure-html/unnamed-chunk-33-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">OptimalCutpoints</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pcorte_SpEqualSe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/OptimalCutpoints/man/optimal.cutpoints.html">optimal.cutpoints</a></span><span class="op">(</span>X <span class="op">=</span> <span class="st">"elas"</span>, status <span class="op">=</span> <span class="st">"status"</span>, tag.healthy<span class="op">=</span> <span class="fl">0</span>, methods<span class="op">=</span> <span class="st">"SpEqualSe"</span>, data <span class="op">=</span> <span class="va">datosmuj</span>, pop.prev<span class="op">=</span> <span class="cn">NULL</span>, ci.fit <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">pcorte_Youden</span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## optimal.cutpoints.default(X = "elas", status = "status", tag.healthy = 0, </span></span>
<span><span class="co">##     methods = "Youden", data = datoshom, pop.prev = NULL, ci.fit = TRUE)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Area under the ROC curve (AUC):  0.722 (0.612, 0.831) </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## CRITERION: Youden</span></span>
<span><span class="co">## Number of optimal cutoffs: 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##                     Estimate 95% CI lower limit 95% CI upper limit</span></span>
<span><span class="co">## cutoff            38.0000000                  -                  -</span></span>
<span><span class="co">## Se                 0.6543210          0.5404147          0.7565737</span></span>
<span><span class="co">## Sp                 0.7391304          0.5159480          0.8977139</span></span>
<span><span class="co">## PPV                0.8983051          0.7686835          0.9355009</span></span>
<span><span class="co">## NPV                0.3777778          0.2738718          0.6528595</span></span>
<span><span class="co">## DLR.Positive       2.5082305          1.2382379          5.0807845</span></span>
<span><span class="co">## DLR.Negative       0.4676834          0.3180320          0.6877538</span></span>
<span><span class="co">## FP                 6.0000000                  -                  -</span></span>
<span><span class="co">## FN                28.0000000                  -                  -</span></span>
<span><span class="co">## Optimal criterion  0.3934514                  -                  -</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">pcorte_Youden</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="tema_02_3_curvas_roc_II_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid" width="672"></p>
</div>
<pre><code>## Press return for next page....</code></pre>
<div class="cell-output-display">
<p><img src="tema_02_3_curvas_roc_II_files/figure-html/unnamed-chunk-34-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">OptimalCutpoints</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pcorte_SpEqualSe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/OptimalCutpoints/man/optimal.cutpoints.html">optimal.cutpoints</a></span><span class="op">(</span>X <span class="op">=</span> <span class="st">"elas"</span>, status <span class="op">=</span> <span class="st">"status"</span>, tag.healthy<span class="op">=</span> <span class="fl">0</span>, methods<span class="op">=</span> <span class="st">"SpEqualSe"</span>, data <span class="op">=</span> <span class="va">datoshom</span>, pop.prev<span class="op">=</span> <span class="cn">NULL</span>, ci.fit <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">pcorte_Youden</span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## optimal.cutpoints.default(X = "elas", status = "status", tag.healthy = 0, </span></span>
<span><span class="co">##     methods = "Youden", data = datoshom, pop.prev = NULL, ci.fit = TRUE)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Area under the ROC curve (AUC):  0.722 (0.612, 0.831) </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## CRITERION: Youden</span></span>
<span><span class="co">## Number of optimal cutoffs: 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##                     Estimate 95% CI lower limit 95% CI upper limit</span></span>
<span><span class="co">## cutoff            38.0000000                  -                  -</span></span>
<span><span class="co">## Se                 0.6543210          0.5404147          0.7565737</span></span>
<span><span class="co">## Sp                 0.7391304          0.5159480          0.8977139</span></span>
<span><span class="co">## PPV                0.8983051          0.7686835          0.9355009</span></span>
<span><span class="co">## NPV                0.3777778          0.2738718          0.6528595</span></span>
<span><span class="co">## DLR.Positive       2.5082305          1.2382379          5.0807845</span></span>
<span><span class="co">## DLR.Negative       0.4676834          0.3180320          0.6877538</span></span>
<span><span class="co">## FP                 6.0000000                  -                  -</span></span>
<span><span class="co">## FN                28.0000000                  -                  -</span></span>
<span><span class="co">## Optimal criterion  0.3934514                  -                  -</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">pcorte_Youden</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="tema_02_3_curvas_roc_II_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid" width="672"></p>
</div>
<pre><code>## Press return for next page....</code></pre>
<div class="cell-output-display">
<p><img src="tema_02_3_curvas_roc_II_files/figure-html/unnamed-chunk-35-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section></section><section id="determinación-de-tamaños-muestrales" class="level2"><h2 class="anchored" data-anchor-id="determinación-de-tamaños-muestrales">Determinación de tamaños muestrales</h2>
<p>[faltan dos slides que ni me he leído]</p>
<p>Forma de proceder:</p>
<ol type="1">
<li><p>Calculamos los tamaños utilizando las aproximaciones a la distribución normal previas.</p></li>
<li><p>Mediante simulación comprobamos si alcanzamos o no la potencia deseada. En caso negativo, incrementamos los tamaños hasta obtener la potencia fijada.</p></li>
</ol>
<p>[<strong>Ejemplo 2.11.</strong>]</p>
<p>La sensibilidad y especificidad del test urinario para la clamidia se esperan que sean 0.9 y 0.95, respectivamente. Debe mostrarse que al menos se consiguen sensibilidad y especificidad de 0.75 y 0.8, respectivamente, para considerar el test urinario en futuras evaluaciones. Se trata de determinar a cuántas personas con clamidia y a cuántas sin clamidia hay que aplicarle el test para conseguir el objetivo con una potencia del 90 %.</p>
<p><span class="math inline">\(H0: Se \le 0.75\)</span> o bien <span class="math inline">\((1-Sp) \ge 0.2\)</span></p>
<p><span class="math inline">\(H1: Se&gt;0.75 \text{ y } (1-Sp)&lt;0.2\)</span></p>
<p><span class="math inline">\(1\beta = 0.9\)</span> para <span class="math inline">\(TPF1=0.9, FPF1=0.05\)</span></p>


</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copiado");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copiado");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation column-body"><div class="nav-page nav-page-previous">
      <a href="../tema_02/tema_02_2_comparacion_test_y_tamanyos_muestrales_II.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-title">2. Comparación de test y tratamiento del tamaño muestral (II) <span style="color:green;">✓</span></span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../tema_02/tema_02_3_curvas_roc_final.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-title">curvas ROC - segunda parte</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>
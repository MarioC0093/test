<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="es" xml:lang="es"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Máster de Bioestadística - Probabilidad y Simulación</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../tema_02/tema_02_2_comparacion_test_y_tamanyos_muestrales.html" rel="next">
<link href="../tema_02/tema_02_1_introduccion.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "Sin resultados",
    "search-matching-documents-text": "documentos encontrados",
    "search-copy-link-title": "Copiar el enlace en la búsqueda",
    "search-hide-matches-text": "Ocultar resultados adicionales",
    "search-more-match-text": "resultado adicional en este documento",
    "search-more-matches-text": "resultados adicionales en este documento",
    "search-clear-button-title": "Borrar",
    "search-detached-cancel-button-title": "Cancelar",
    "search-submit-button-title": "Enviar",
    "search-label": "Buscar"
  }
}</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><link rel="stylesheet" href="../css/styles.css">
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../tema_02/tema_02.html">TEMA 2</a></li><li class="breadcrumb-item"><a href="../tema_02/tema_02_1_2_cohortes_y_casos_control.html"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">1.2 Estudios de cohorte y casos-control <span style="color:green;">✓</span></span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Buscar"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Introducción</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../DUDAS.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Dudas</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../tema_00/tema_00.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">TEMA 0</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Alternar sección">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tema_00/tema_00_introduccion.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Introducción</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../tema_01/tema_01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">TEMA 1</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Alternar sección">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tema_01/tema_01_1_introduccion.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">1. Introducción <span style="color:green;">✓</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tema_01/tema_01_2_concordancia_categoricas.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">2. Análisis de concordancia en variables categóricas <span style="color:green;">✓</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tema_01/tema_01_3_concordancia_numericas.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">3. Análisis de concordancia en variables numéricas <span style="color:green;">✓</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tema_01/tema_01_4_tamanyo_muestral.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">4. Cálculo del tamaño muestral <span style="color:green;">✓</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../tema_02/tema_02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">TEMA 2</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Alternar sección">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tema_02/tema_02_1_introduccion.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">1.1. Conceptos básicos <span style="color:green;">✓</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tema_02/tema_02_1_2_cohortes_y_casos_control.html" class="sidebar-item-text sidebar-link active"><span class="chapter-title">1.2 Estudios de cohorte y casos-control <span style="color:green;">✓</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tema_02/tema_02_2_comparacion_test_y_tamanyos_muestrales.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">2. Comparación de test y tratamiento del tamaño mmuestral <span style="color:red;">✗</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tema_02/tema_2_28_11_2024.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">tema_2_28_11_2024</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tema_02/tema_02_3_curvas_roc.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">3. Validación de biomarcadores. Curvas ROC <span style="color:red;">✗</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tema_02/tema_02_3_curvas_roc_final.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">curvas ROC - segunda parte</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../tema_03/tema_03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">TEMA 3</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Alternar sección">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tema_03/tema_03_1_introduccion.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">1. Introducción <span style="color:green;">✓</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tema_03/tema_03_2_selección_aleatoria.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">2. Selección aleatoria de pacientes y asignación de tratamientos <span style="color:red;">✗</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tema_03/tema_03_3_obtener_datos_simulados.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">3. Obtener datos simulados a partir de observaciones reales <span style="color:green;">✓</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tema_03/tema_03_4_remuestreo_inferencia_roc.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">4. Técnicas de remuestreo aplicadas a la inferencia de curvas ROC <span style="color:red;">✗</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="99"><h2 id="toc-title">In this page</h2>
   
  <ul>
<li>
<a href="#estudios-cohorte" id="toc-estudios-cohorte" class="nav-link active" data-scroll-target="#estudios-cohorte">Estudios cohorte</a>
  <ul>
<li><a href="#estimadores-i" id="toc-estimadores-i" class="nav-link" data-scroll-target="#estimadores-i">Estimadores (I)</a></li>
  <li><a href="#regi%C3%B3n-de-confianza-para-widehatse-widehat1-sp" id="toc-región-de-confianza-para-widehatse-widehat1-sp" class="nav-link" data-scroll-target="#regi%C3%B3n-de-confianza-para-widehatse-widehat1-sp">Región de confianza para (<span class="math inline">\(\widehat{Se}, (\widehat{1-Sp})\)</span>)</a></li>
  <li>
<a href="#estimadores-ii---dlr" id="toc-estimadores-ii---dlr" class="nav-link" data-scroll-target="#estimadores-ii---dlr">Estimadores (II) - DLR</a>
  <ul>
<li><a href="#ic-para-las-razones-de-verosimilutes" id="toc-ic-para-las-razones-de-verosimilutes" class="nav-link" data-scroll-target="#ic-para-las-razones-de-verosimilutes">IC para las razones de verosimilutes</a></li>
  </ul>
</li>
  </ul>
</li>
  <li><a href="#estudios-caso-control" id="toc-estudios-caso-control" class="nav-link" data-scroll-target="#estudios-caso-control">Estudios caso control</a></li>
  <li>
<a href="#comparaci%C3%B3n-entre-pruebas-diagn%C3%B3sticas" id="toc-comparación-entre-pruebas-diagnósticas" class="nav-link" data-scroll-target="#comparaci%C3%B3n-entre-pruebas-diagn%C3%B3sticas">Comparación entre pruebas diagnósticas</a>
  <ul>
<li><a href="#probabilidades-de-clasificaci%C3%B3n" id="toc-probabilidades-de-clasificación" class="nav-link" data-scroll-target="#probabilidades-de-clasificaci%C3%B3n">Probabilidades de clasificación</a></li>
  <li><a href="#valores-predictivos" id="toc-valores-predictivos" class="nav-link" data-scroll-target="#valores-predictivos">Valores predictivos</a></li>
  <li><a href="#razones-de-verosimilitud-de-diagn%C3%B3stico" id="toc-razones-de-verosimilitud-de-diagnóstico" class="nav-link" data-scroll-target="#razones-de-verosimilitud-de-diagn%C3%B3stico">Razones de verosimilitud de diagnóstico:</a></li>
  </ul>
</li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title"><span class="chapter-title">1.2 Estudios de cohorte y casos-control <span style="color:green;">✓</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="../attachments/tema_02_cuadricula_DLRs.png" style="width:50.0%;height:50.0%" class="figure-img"></p>
</figure>
</div>
<p>Validación de la estimación mediante el intervalo de confianza. (medir de dónde a dónde podría tener mis estimaciones) <span class="math inline">\(\Rightarrow\)</span> ¿Y si no hubiera trabajado con esta poblacion sino con otra con las mismas caracteristicas y de las misma poblacion?</p>
<p>Mejor hacer un IC con una muestra pequeña que tirar a bootstrap. Los elementos de la muestra son totalmente independientes y los resultados de uno no depende del otro. Con bootstrap no creamos nada nuevo sino que depende de la muestra original. (a final del tema3 se detalla circustancias donde es mejor usar bootstra)</p>
<p><strong>Siempre que tengamos una alternativa teórica es preferible a bootstrap.</strong></p>
<section id="estudios-cohorte" class="level2"><h2 class="anchored" data-anchor-id="estudios-cohorte">Estudios cohorte</h2>
<p>Supongamos que realizamos un experimento con resultados {éxito, fracaso} y sea <span class="math inline">\(\text{p = p(éxito)}\)</span>. Repetimos el experimento n veces en condiciones independientes. Sea <span class="math inline">\(X \sim \text{"número de éxitos en n pruebas"}\)</span> bajo el modelo teórico B(n,p). Sea <span class="math inline">\(\hat p\)</span> = número de éxitos observados en el total de muestras = <span class="math inline">\(\frac{x}{n}\)</span></p>
<p><span class="math inline">\(N\)</span> = nº de sujetos seleccionados aleatoriamente de la población<br><span class="math inline">\(n_{{D}}\)</span> = nº de sujetos con la enfermedad de los N seleccionado<br><span class="math inline">\(n_{\overline{D}}\)</span> = nº de sujetos sin la enfermedad de los N seleccionados<br><span class="math inline">\(n^+\)</span> = nº de sujetos que han dado positivo en el test de los N<br><span class="math inline">\(n^-\)</span> = nº de sujetos que han dado negativo en el test de los N</p>
<div class="quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><span class="math display">\[
\scriptsize
\begin{array}{cc|c|c|c}
&amp; &amp; \text{prueba +} &amp; \text{prueba -} &amp; \\
&amp; &amp; D = 0 &amp; D = 1 &amp; \\
\hline
\text{persona enferma} &amp; \text{Y = 0} &amp; n_{\overline{D}}^{-} &amp; n_{D}^{-} &amp; n^{-} \\
\text{persona sana} &amp; \text{Y = 1} &amp; n_{\overline{D}}^{+} &amp; n_{D}^{+} &amp; n^{+} \\
\hline
&amp;&amp; n_{\overline{D}} &amp; n_{D}
\end{array}
\]</span></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><span class="math display">\[
\scriptsize
\begin{array}{c|c|c|c}
&amp; \text{persona enferma} &amp; \text{persona sana} &amp; \\
&amp; \text{Y = 0} &amp; \text{Y = 1} &amp; \\
\hline
\text{prueba +} \ D = 0 &amp; n_{\overline{D}}^{-} &amp; n_{\overline{D}}^{+} &amp; n_{\overline{D}} \\
\text{prueba -} \ D = 1 &amp; n_{D}^{-} &amp; n_{D}^{+} &amp; n_{D} \\
\hline
&amp; n^{-} &amp; n^{+}
\end{array}
\]</span></p>
</div>
</div>
</div>
<div class="recuadro_1">
<p>Detrás de cada una de las probabilidades hay una distribucion binomial. <strong>Los intervalos de confianza de cada proporción binomial <span class="math inline">\(\hat p\)</span></strong> se puede calcular a través de:</p>
<ul>
<li>
<strong>Intervalos de confianza exactos</strong> <span class="math inline">\(\Rightarrow\)</span> Intervalo de Clopper-Pearson (se basa en la función de distribución binomial acumulativa invertida)</li>
</ul>
<p><span class="math display">\[
\text{IC}_{1-\alpha} = \left[
\frac{x}{x + (n - x + 1)F_{1-\alpha/2, 2x, 2(n-x+1)}}, \,
\frac{(x+1)F_{\alpha/2, 2(x+1), 2(n-x)}}{(n-x) + (x+1)F_{\alpha/2, 2(x+1), 2(n-x)}}
\right]
\]</span></p>
<ul>
<li>
<strong>La distribución binomial o métodos asintóticos</strong> <span class="math inline">\(\Rightarrow\)</span> Cuando <span class="math inline">\(n\)</span> es grande, las observaciones son independientes y <span class="math inline">\(\hat p\)</span> no es cercano a 0 o 1 (eventos raros)</li>
</ul>
<p><span class="math display">\[
\left( \frac{x}{m} \pm z_{\alpha/2} \sqrt{\frac{ x\left(1 - \frac{x}{m}\right)}{m}} \right)
\]</span></p>
</div>
<section id="estimadores-i" class="level3"><h3 class="anchored" data-anchor-id="estimadores-i">Estimadores (I)</h3>
<div class="recuadro_1">
<p>Para estimar la probabilidad de verderos negativos <span class="math inline">\(\widehat{Se}\)</span> se usa la v.a.:</p>
<p><span class="math display">\[
X \sim \text{"número de negativos en el grupo de enfermos"} \sim Bin(n_{D}^{+}, Se) = Bin(n_{D}^{+}, n_D)
\]</span></p>
<p>Para estimar la probabilidad de falsos positivos <span class="math inline">\(\widehat{(1-Sp)}\)</span> se usa la v.a.:</p>
<p><span class="math display">\[
X \sim \text{"número de enfermos en el grupo de sanos"} \sim Bin(n_{\overline{D}}^{+}, (1-Sp)) = Bin(n_{\overline{D}}^{+}, n_{\overline{D}})
\]</span></p>
<p>Para estimar el valor predictivo <span class="math inline">\(\widehat{PPV}\)</span> se usa la v.a.:</p>
<p><span class="math display">\[
X \sim \text{"número de individuos enfermos en sujetos con test postitivo."} \sim Bin(n_{\overline{D}}, (1-Sp)) TERMINAR
\]</span></p>
<p><span class="math display">\[
X \sim Bin(n^+, ppv), \quad \quad x =  n_{\overline{D}}^+
\]</span></p>
<p>Para estimar el valor predictivo <span class="math inline">\(\widehat{NPV}\)</span> se usa la v.a.:</p>
<p><span class="math display">\[
X \sim \text{número de individuos enferos en los que tienen test postitivo} ~ Bin(n^-, npv), \quad \quad x =  n_{\overline{D}}^- TERMINAR
\]</span></p>
</div>
<p>Ejemplo del intervalo de confianza exacto para la sensibilidad.</p>
<p><span class="math display">\[
IC_{1-\alpha} (\widehat{\text{Se}}) =
\left(
\frac{1}{1 + \frac{n_D^+ F_{2n_D^+ , 2(n_D - n_D^+ + 1); 1-\alpha/2}}{n_D^+ - n_D^+ + 1}} , \
\frac{1}{1 + \frac{(n_D^+ + 1) F_{2(n_D^+ + 1), 2(n_D - n_D^+); \alpha/2}}{n_D - n_D^+}}
\right)
\]</span></p>
<p>Ejemplo del intervalo de confianza por el método asintótico para la sensibilidad.</p>
<p><span class="math display">\[
IC_{1-\alpha} (\widehat{Se}) =
\left(
\frac{n^+_D}{n_D} - z_{\alpha/2} \cdot \sqrt{\frac{1}{n_D} \cdot \frac{n^+_D \left( n_D - n^+_D \right)}{n_D}}, \;
\frac{n^+_D}{n_D} + z_{\alpha/2} \cdot \sqrt{\frac{1}{n_D} \cdot \frac{n^+_D \left( n_D - n^+_D \right)}{n_D}}
\right)
\]</span></p>
<p><u><strong>Ejemplo 2.2.</strong></u></p>
<p>El objetivo es determinar qué constituye un éxito y en qué subgrupo estamos evaluando la cantidad de éxitos.</p>
<p>En el cálculo de estimaciones e IC, en cada IC que genero cometo un error y a mayor númeor de estimaciones e IC el error total de mi proyecto aumenta o la precision total disminuye.<br>
- Probabiidad de que la sensibilidad esté dentro de mi intervalo, 0.9.<br>
- Probabiidad de que la especificidad esté dentro de mi intervalo, 0.9.<br>
- Probabiidad de que la sensibilidad esté dentro de mi intervalo y de que la especificidad esté dentro de mi intervalo, 0.9*0.9. (es un cálculo teórico para entenderlo)</p>
<p>Los estimadores de la probabilidades de clasificación son independientes. Esto nos motiva a buscar una region de confianza de tal forma que ambas estimaciones estén dentro de esa región con una probabilidad del 0.9.</p>
</section><section id="región-de-confianza-para-widehatse-widehat1-sp" class="level3"><h3 class="anchored" data-anchor-id="región-de-confianza-para-widehatse-widehat1-sp">Región de confianza para (<span class="math inline">\(\widehat{Se}, (\widehat{1-Sp})\)</span>)</h3>
<div class="recuadro_1">
<p>Confianza bidimensional <span class="math inline">\(1-\alpha = \text{"prob de caer en el IC * prob de caer en el otro IC"} = \beta^2 : \beta = \sqrt{1-\alpha}\)</span>.</p>
</div>
<p>La RC es una zona de confort en dos dimensiones. En caso de trabajar en dos dimensiones separadas consigo una confianza menor.</p>
<p><u><strong>Ejemplo 2.2. (cont.)</strong></u></p>
<p>Los siguientes datos corresponden a un estudio cohorte realizado en el que se tenían 1465 hombres con posible enfermedad coronaria para los que se tiene el resultado de una prueba diagnóstica de esfuerzo (EST). La determinación de la enfermedad se realiza con arteriografía, la medida gold standard. Los datos obtenidos son los siguientes:</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>col1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">327</span>, <span class="fl">115</span><span class="op">)</span>,</span>
<span>                 col2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">208</span>, <span class="fl">815</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"D=0"</span>, <span class="st">"D=1"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Y=0"</span>, <span class="st">"Y=1"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_extended</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">df</span>, <span class="st">"Total"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colSums</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">df_extended</span> <span class="op">&lt;-</span> <span class="va">df_extended</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="st">"Total"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">df_extended</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">df_extended</span></span>
<span><span class="co">##       D=0  D=1 Total</span></span>
<span><span class="co">## Y=0   327  208   535</span></span>
<span><span class="co">## Y=1   115  815   930</span></span>
<span><span class="co">## Total 442 1023  1465</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>En <a href="https://www.medcalc.org/calc/diagnostic_test.php">medcalc</a> por defecto te calcula la asitótica (independientemente del tamaño que tengas). (para estudio de cohortes no hace falta indicarle la prevalencia porque da igual en este caso)</p>
<p><span class="math inline">\(\widehat{PPV}\)</span>, estimo los casos positivos: 930 + cuántos lo son de verdad: 815 = <span class="math inline">\(\frac{815}{930}\)</span></p>
<p><span class="math inline">\(\widehat{NPV}\)</span>, casos negativos: 327 + cuántos lo son de verdad: 535 = <span class="math inline">\(\frac{327}{535}\)</span>, un resultado positivo en la prueba estaría asociado a detectar un 87,63% de los casos</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span><span class="op">(</span><span class="st">"calculo_estimadores_pruebas_diagnosticas.R"</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">n_D</span> <span class="op">&lt;-</span> <span class="fl">1023</span></span>
<span><span class="va">n_D_pos</span> <span class="op">&lt;-</span> <span class="fl">815</span></span>
<span><span class="va">n_D_neg</span> <span class="op">&lt;-</span> <span class="fl">208</span></span>
<span><span class="va">n_noD</span> <span class="op">&lt;-</span> <span class="fl">442</span></span>
<span><span class="va">n_noD_pos</span> <span class="op">&lt;-</span> <span class="fl">115</span></span>
<span><span class="va">n_noD_neg</span> <span class="op">&lt;-</span> <span class="fl">327</span></span>
<span><span class="va">n_pos</span> <span class="op">&lt;-</span> <span class="va">n_D_pos</span> <span class="op">+</span> <span class="va">n_noD_pos</span></span>
<span><span class="va">n_neg</span> <span class="op">&lt;-</span> <span class="va">n_D_neg</span> <span class="op">+</span> <span class="va">n_noD_neg</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/">tibble</a></span><span class="op">)</span></span>
<span><span class="fu">calculo_estimadores</span><span class="op">(</span><span class="va">n_D</span>, <span class="va">n_D_pos</span>, <span class="va">n_D_neg</span>, <span class="va">n_noD</span>, <span class="va">n_noD_pos</span>, <span class="va">n_noD_neg</span>, <span class="va">n_pos</span>, <span class="va">n_neg</span>, tipo_estudio <span class="op">=</span> <span class="st">"cohorte"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span><span class="op">(</span>var <span class="op">=</span> <span class="st">"rownames"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">rownames</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Se'</span>, <span class="st">'Sp'</span>, <span class="st">'Uno_menos_Sp'</span>, <span class="st">'PPV'</span>, <span class="st">'NPV'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">##       rownames   Puntual  IC.lower  IC.upper</span></span>
<span><span class="co">## 1           Se 0.7966764 0.7720135 0.8213394</span></span>
<span><span class="co">## 2           Sp 0.7398190 0.6989177 0.7807203</span></span>
<span><span class="co">## 3 Uno_menos_Sp 0.2601810 0.2192797 0.3010823</span></span>
<span><span class="co">## 4          PPV 0.8763441 0.8551872 0.8975010</span></span>
<span><span class="co">## 5          NPV 0.6112150 0.5699080 0.6525219</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Un resultado positivo en la prueba estaría asociado a detectar un 87,63% de los casos.</p>
<p>Estimamos que al 79,67 % de los enfermos se les detectará la enfermedad mediante la prueba de esfuerzo. Estimamos que un 26,02 % de los sanos también se les diagnosticará como enfermos.</p>
<p><strong>Región de confianza rectangular: <span class="math inline">\(\displaylines{IC_{95} (\widehat{1-Sp}, \widehat{Se}) = (0.2193, 0.3011) x (0.772, 0.821) : \\ (1−\alpha^{*}) * (1−\alpha^{*}) = (1−\alpha) \Rightarrow (1−\alpha^{*}) = \sqrt{1−\alpha} = \sqrt{0.95} = 0.9747}\)</span></strong></p>
</section><section id="estimadores-ii---dlr" class="level3"><h3 class="anchored" data-anchor-id="estimadores-ii---dlr">Estimadores (II) - DLR</h3>
<p>Comparación de casos positivos dentro del grupo de enfermos y casos positivos dentro del grupo de sanos <span class="math inline">\(\Rightarrow\)</span> En funcion del cociente se puede decididr cuál es más verosímil.</p>
<p>Se estiman las razones de verosimilitud a través de las estimaciones de las probabilidades de clasificaciones.</p>
<div class="quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><span class="math inline">\(\widehat{DLR^+} = \frac{\widehat{Se}}{\widehat{1-Sp}} = \frac{{\frac{n_{D}^{+}}{n_D}}}{\frac{n_{\overline{D}}^{+}}{n_{\overline{D}}}}\)</span></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><span class="math inline">\(\widehat{DLR^-} = \frac{\widehat{1-Se}}{\widehat{Sp}} = \frac{{\frac{n_{D}^{-}}{n_D}}}{\frac{n_{\overline{D}}^{-}}{n_{\overline{D}}}}\)</span></p>
</div>
</div>
</div>
<section id="ic-para-las-razones-de-verosimilutes" class="level4"><h4 class="anchored" data-anchor-id="ic-para-las-razones-de-verosimilutes">IC para las razones de verosimilutes</h4>
<p>Los intervalos de confianza de cada razón de verosimilitud estimada se determinan a partir del resultado asintótico.</p>
<p>Pasamos los DLR a escala logarítmica y separamos las componentes sensibilidad y especificidad. Trabajamos con el método delta.</p>
<p><span class="math display">\[
\left( \log DLR^{+}, \log DLR^{-} \right) \approx \mathcal{N} \left( \left( \log DLR^{+}, \log DLR^{-} \right);
\begin{pmatrix}
\frac{1 - Se}{n_D Se} + \frac{Sp}{n_D (1 - Sp)} &amp; - \left( \frac{1}{n_D} + \frac{1}{n_D} \right) \\
\left( \frac{1}{n_D} + \frac{1}{n_D} \right) &amp; \frac{Se}{n_D (1 - Se)} + \frac{1 - Sp}{n_D Sp}
\end{pmatrix}
\right)
\]</span></p>
<p><u><strong>Ejemplo.</strong></u></p>
<p>Dado el <span class="math inline">\(IC(log(\widehat{DLR^+})) = (-0.6, 2) : e^-0.6 &lt; \widehat{DLR+} &lt; e^2\)</span>. Se obtiene el <span class="math inline">\(IC(\widehat{DLR^+}) = (e^{-0.6}, e^2) = (0.55, 0.79)\)</span></p>
<p>“Las dos razones de verosimilitud no son independientes sino que cuando trabajamos con sus logaritmos tienen un comportamiento normal bidimensional. La covarianza negativa nos indica que una razón aunmenta la otra disminuye.”</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/">MASS</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Definimos la media y la matriz de covarianza</span></span>
<span><span class="va">media</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">covarianza</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generamos los puntos con una distribución normal multivariada</span></span>
<span><span class="va">datos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MASS/man/mvrnorm.html">mvrnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1000</span>, mu <span class="op">=</span> <span class="va">media</span>, Sigma <span class="op">=</span> <span class="va">covarianza</span><span class="op">)</span></span>
<span><span class="va">datos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">datos</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">datos</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"X"</span>, <span class="st">"Y"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">plot3D</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>, <span class="fl">3</span>, length <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>, <span class="fl">3</span>, length <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span>
<span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/outer.html">outer</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="fu">mclust</span><span class="fu">::</span><span class="fu"><a href="https://mclust-org.github.io/mclust/reference/dmvnorm.html">dmvnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span>, mean <span class="op">=</span> <span class="va">media</span>, sigma <span class="op">=</span> <span class="va">covarianza</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/plot3D/man/persp3D.html">persp3D</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">z</span>, theta <span class="op">=</span> <span class="fl">30</span>, phi <span class="op">=</span> <span class="fl">20</span>, expand <span class="op">=</span> <span class="fl">0.6</span>, col <span class="op">=</span> <span class="st">"lightblue"</span>, main <span class="op">=</span> <span class="st">"Distribución Gaussiana Bidimensional"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html">mtext</a></span><span class="op">(</span><span class="st">"Esto lo hago porque me aburro"</span>, side <span class="op">=</span> <span class="fl">3</span>, line <span class="op">=</span> <span class="fl">0.5</span>, cex <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span>  <span class="co"># side = 3 coloca el texto arriba, line ajusta la distancia</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="tema_02_1_2_cohortes_y_casos_control_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><u><strong>Ejemplo 2.2. (cont. 21)</strong></u></p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">calculo_estimadores</span><span class="op">(</span><span class="va">n_D</span>, <span class="va">n_D_pos</span>, <span class="va">n_D_neg</span>, <span class="va">n_noD</span>, <span class="va">n_noD_pos</span>, <span class="va">n_noD_neg</span>, <span class="va">n_pos</span>, <span class="va">n_neg</span>, tipo_estudio <span class="op">=</span> <span class="st">"cohorte"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span><span class="op">(</span>var <span class="op">=</span> <span class="st">"rownames"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">rownames</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'DLR_pos'</span>, <span class="st">'DLR_neg'</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  rownames   Puntual  IC.lower  IC.upper
1  DLR_pos 3.0620086 2.6086910 3.5941001
2  DLR_neg 0.2748288 0.2405299 0.3140186</code></pre>
</div>
</div>
<p><span class="math inline">\(DLR^{+}\)</span>: un resultado positivo es 3 veces más creíble en el grupo de enfermos que en el grupo de sanos</p>
<p><span class="math inline">\(DLR^{-}\)</span>: comparamos negativos en el grupo de sanos y en el grupo de enfermos. En el grupo de sanos deben ser pocos, por que lo que <span class="math inline">\(DLR^{+}&lt;&lt;&lt;1\)</span>. Para facilitar la comparativa se le suele dar la vuelta (al parecer es más fácil interpretar un 2 que un 0.5)</p>
<p>En el 95 % de las muestras es entre 2.6 y 3.5 veces más creíble un resultado positivo en el grupo de los enfermos que en los sanos.</p>
<p>El test de esfuerzo da positivo tres veces más en los enfermos que en sanos. Es tres veces más versosímil encontrar un positivo en la prueba de esfuerzo en un individuo enfermo que en un individio sano.</p>
<p>Cuando tenemos un resultado negativo en la prueba es 3.7 (1/0.2748) más verosímil un negativo en un individuo sano que en un individuo enfermo.</p>
</section></section></section><section id="estudios-caso-control" class="level2"><h2 class="anchored" data-anchor-id="estudios-caso-control">Estudios caso control</h2>
<p>El número de sujetos enfermos seleccionados y el de sujetos sanos seleccionados son predeterminados.</p>
<p>Esta situación equilibrada no suele ser representativa de la realidad. La frecuencia relativa de sujetos enfermos es normalmente mucho mayor que en la población, al menos cuando la prevalencia es relativamente baja.</p>
<p>La prevalencia muestral no representativa de la prevalenciapoblacional no afecta a las estimaciones de sensibilidada, especificidad ni a las razones. Pero sí afectaa los valores predictivos.</p>
<p>Trabajamos suponiendo que tenemos una estimación para la prevalencia real.</p>
<p>En estudios de caso-control la prevalencia de la población no se conserva en la muestra (los sujetos se elige en función de si tienen o no la enfermedad). En los estudios de cohortes ese problema no existe ya que se ha buscado un grupo de individuos que se someten a un riesgo y se espera a ver si tenían o no la enfermedad.</p>
<p><strong>Definimos los valores predictivos en función de la prevalencia.</strong> Con el teorema de Bayes se expresan los valores predictivos en función de la sensibilidad y la especificidad.</p>
<p><span class="math display">\[
\scriptsize
\begin{aligned} PPV &amp;= P(D=1 | Y=1) \\ &amp;= \frac{p(D=1 \cap Y=1)}{p(Y=1)} \\ &amp;= \frac{p(Y=1 | D=1) · p(D=1)} {p(Y=1 | D=1) · p(D=1) + p(Y=1 | D=0) · p(D=0)} \\ &amp;= \frac{\rho * Se}{\rho * Se + (1-\rho)(1-Sp)} \end{aligned}
\begin{aligned} NPV &amp;= P(D=0 | Y=0) \\ &amp;= \frac{p(D=0 \cap Y=0)}{p(Y=0)} \\ &amp;= \frac{p(Y=0 | D=0) · p(D=0)} {p(Y=0 | D=0) · p(D=0) + p(Y=0 | D=1) · p(D=1)} \\ &amp;= \frac{(1-\rho) · Sp}{(1-\rho) · Sp + \rho · (1-Sp)} \end{aligned}
\]</span></p>
<p><span class="math display">\[\hat{PPV} = \frac{\rho * \hat{Se}}{\rho * \hat{Se} + (1-\rho)(1-\hat{Sp})} \quad \quad \quad \hat{NPV} = \frac{(1-\rho) · \hat{Sp}}{(1-\rho) · \hat{Sp} + \rho · (1-\hat{Sp})}\]</span></p>
<p>Supongamos que desconocemos el valor exacto de la prevalencia:</p>
<ul>
<li>Si la prevalencia es máxima, <span class="math inline">\(\text{si }\rho=1 \Rightarrow PPV = 1 \text{ y } NPV = 0\)</span>.</li>
<li>Si la prevalencia es mínima, <span class="math inline">\(\text{si }\rho=0 \Rightarrow PPV = 0 \text{ y } NPV = 1\)</span>.</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<p><img src="tema_02_1_2_cohortes_y_casos_control_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="recuadro_1">
<p><strong>Definimos los IC valores predictivos en función de las DLR.</strong></p>
<p><span class="math display">\[\scriptsize \frac{PPV}{1-PPV} = DLR^+ (\frac{\rho}{1-\rho}) \Rightarrow ln(\frac{PPV}{1-PPV}) = ln(DLR^+) + ln(\frac{\rho}{1-\rho}) = ln(DLR^+) + logit(\rho) = ln(DLR^+) + H\]</span></p>
</div>
<p><span class="math inline">\(\begin{aligned} \text{Sea } IC\left(\ln\left(\widehat{DLR^-}\right)\right) = (A, B) &amp;\Rightarrow A &lt; ln(\widehat{DLR^-}) &lt; B \\ &amp;\Rightarrow -B &lt; -ln(\widehat{DLR^-}) &lt; -A \\ &amp;\Rightarrow - H - B &lt; logit(NPV) &lt; - H - A \\ &amp;\Rightarrow - (H + B) &lt; logit(NPV) &lt; - (H + A) \\ &amp;\Rightarrow - (H + B) &lt; ln(\frac{NPV}{1-NPV}) &lt; - (H + A) \\ &amp;\Rightarrow e^{- (H-B)} &lt; \frac{NPV}{1-NPV} &lt; e^{- (H+A)} \\ &amp;\Rightarrow e^{- (H-B)} * (1-NPV) &lt; NPV &lt; e^{- (H+A)} * (1-NPV) \\ &amp;\Rightarrow \text{Como } \widehat{ppv} &gt; 0, exp^{b+H} &gt; exp^{a+H}(1-\widehat{ppv}) &gt; \frac{exp^{b+H}}{1+exp^{b+H}}, \\ &amp; \quad\quad \frac{e^{- (H-B)}}{1 -e^{- (H-B)}} &lt; NPV &lt; \frac{e^{- (H+A)}}{1 -e^{- (H+A)}} \end{aligned}\)</span></p>
<p><u><strong>Ejemplo 2.3.</strong></u></p>
<p>Supongamos que en un estudio caso-control, para una enfermedad con una prevalencia de 2%, el intervalo de confianza para el logaritmo de la razón de verosimilitud de diagnóstico positivo es <span class="math inline">\(IC_{95} \left( log(\widehat{DLR^+}) \right) = (1, 2.5)\)</span>) ¿Cuál sería el intervalo de confianza para el valor predictivo positivo?</p>
<p><span class="math inline">\(IC_{95}(logit(\widehat{PPV^+})) = ( log \left( \frac{0.02}{0.98} \right) + 1.5, log \left( \frac{0.02}{0.98} \right) + 2.5 ) = (-2.39, -1.39)\)</span></p>
<p><span class="math inline">\(IC_{95}(\widehat{PPV^+}) = \left( \frac{e^{-2.39}}{1+e^{-2.39}}, \frac{e^{-1.39}}{1+e^{-1.39}} + 2.5 \right) = (0.08, 0.2)\)</span></p>
<p>El IC indica que la prueba diagnóstica no sirve para diagnosticar la enfermedad. Dando positivo el test solo acierta la enfermedad de 0.08 a 0.2. La probabilidad de que dando positivo estemos ante un individuo enfermo es muy baja entre el 8 % y el 20 %. Otra cosa sería el NPV. No lo sabemos pero por lo menos podría ser buena para determinar que con un resultado negativo el paciente estuviera sano.</p>
<p>La prueba diagnóstica no es buena ya que solo acertaría entre un 0.08 y un 0.2 de las veces basándome en haber visto un valor positivo en la prueba. Si tomáramos esta prueba diagnóstica para hacer un diagnóstico en función del resultado los aciertos son muy pocos.</p>
</section><section id="comparación-entre-pruebas-diagnósticas" class="level2"><h2 class="anchored" data-anchor-id="comparación-entre-pruebas-diagnósticas">Comparación entre pruebas diagnósticas</h2>
<p>El objetivo es comparar 2 test diagnósticos: test A y test B. Podemos comparar tres medidas (cada una de ellas enfocadas a un objetivo distinto): - Probabilidades de clasificación (cómo refleja la prueba el estado real del paciente.)</p>
<ul>
<li>Valores predictivos (cómo refleja la prueba el estado real del paciente)</li>
<li>Razones de verosimilitud de diagnóstico (cómo de creible es un valor postivio o negativo)</li>
</ul>
<p>En caso de no encontrar una prueba diagnóstica “superior” a otra basándonos en las probabilidades de clasificación, podemos intentar encontrarla por medio de los valores predictivos.</p>
<p><strong>Métricas para la comparación.</strong></p>
<ul>
<li>Diferencias absolutas (<span class="math inline">\(\Delta\)</span>) (p.e. <span class="math inline">\(\Delta Se(A,B) = Se(A) - Se(B))\)</span>
</li>
<li>Oddratios (ο) (p.e. <span class="math inline">\(οSe(A,B) = \frac{\frac{Se(A)}{1-Se(A)}}{\frac{Se(B)}{1-Se(B)}} = \frac{Se(A)·(1-Se(B))}{Se(B)·(1-Se(A))}\)</span>
</li>
<li>Cocientes o medidas relativas (r) (p.e. <span class="math inline">\(rSe(A,B) = \frac{Se(A)}{Se(B)}\)</span>)</li>
</ul>
<p>Aunque se puede elegir cualquiera de ellas para comparar dos pruebas, los cocientes son más fáciles de interpretar que los odd ratios. Intenamos encontrar diferencias absolutas y en caso de no haberlas lo intentamos con los cocientes relativos.</p>
<p>En caso de tener dos pruebas diagnósticas basadas en unidades distintas, no podemos hacer difrencia de una contra la otra, pero sí puedo hacer comparaciones haciendo comparaciones entre ambas pruebas.</p>
<section id="probabilidades-de-clasificación" class="level3"><h3 class="anchored" data-anchor-id="probabilidades-de-clasificación">Probabilidades de clasificación</h3>
<p>Se puede utilizar cualquiera métrica de comparación. Aunque la más utilizada es la métrica de cocientes o medidas relativas debido a su fácil interpretación.</p>
<p>Ejemplo:<br>
- <span class="math inline">\(rSe(A;B) = \frac{Se(A)}{Se(B)} =25\)</span>: el test A tiene 25 veces más verdaderos positivos que el test B.<br>
- <span class="math inline">\(rSe(A,B) = 0.3\)</span> : la cantidad de verdaderos positivos del test A es el 30 % de los observados en el test B</p>
</section><section id="valores-predictivos" class="level3"><h3 class="anchored" data-anchor-id="valores-predictivos">Valores predictivos</h3>
<p>La métrica utilizada son los odds ratios o cocientes.</p>
<p>Si la prevalencia de la enfermedad es baja:</p>
<ul>
<li><span class="math inline">\(rPPV(A,B) \approx oPPV(A,B)\)</span></li>
<li><span class="math inline">\(rNPV(A,B) \approx 1\)</span></li>
</ul>
<p>Si la prevalencia no es baja es preferible utilizar cocientes</p>
<<<<<<< HEAD
<p>Ejemplo:<br>
- <span class="math inline">\(rPPV(A;B)=2.0\)</span>: un resultado positivo en el test A es 2 veces más indicativo del riesgo de enfermedad que el que tiene un resultado positivo en el test B.</p>
=======
<<<<<<< HEAD
<p>Ejemplo:<br>
- <span class="math inline">\(rPPV(A;B)=2.0\)</span>: un resultado positivo en el test A es 2 veces más indicativo del riesgo de enfermedad que el que tiene un resultado positivo en el test B.</p>
=======
<p>Ejemplo: - rPPV(A;B)=2,0Un resultado positivo en el test A es 2 veces más indicativo del riesgo de enfermedad que el que tiene un resultado positivo en el test B.</p>
>>>>>>> origin/main
>>>>>>> origin/main
</section><section id="razones-de-verosimilitud-de-diagnóstico" class="level3"><h3 class="anchored" data-anchor-id="razones-de-verosimilitud-de-diagnóstico">Razones de verosimilitud de diagnóstico:</h3>
<p>Se comparan con la métrica de cocientes.</p>
<p>Existe una relación con los odds ratios de los valores predictivo:</p>
<ul>
<li><span class="math inline">\(rDLR+(A,B) = oPPV(A,B)\)</span></li>
<li><span class="math inline">\(rDLR-(A,B) = \frac{1}{oNPV(A,B)}\)</span></li>
</ul>
<<<<<<< HEAD
<p>Ejemplo: <span class="math inline">\(DLR^+(A)=3.05\)</span>, <span class="math inline">\(DLR^+(B)=1.71\)</span>.<br>
- Ambos test indican que es más verosímil un resultado positivo en enfermos que en sanos.<br>
- <span class="math inline">\(rDLR^+(A,B) = 1.78\)</span>: el resultado positivo del test A es más informativo del riesgo de enfermedad que el positivo del test B.</p>
=======
<<<<<<< HEAD
<p>Ejemplo: <span class="math inline">\(DLR^+(A)=3.05\)</span>, <span class="math inline">\(DLR^+(B)=1.71\)</span>.<br>
- Ambos test indican que es más verosímil un resultado positivo en enfermos que en sanos.<br>
- <span class="math inline">\(rDLR^+(A,B) = 1.78\)</span>: el resultado positivo del test A es más informativo del riesgo de enfermedad que el positivo del test B.</p>
=======
<p>Ejemplo: DLR+(A)=3,05 DLR+(B)=1,71.<br>
- Ambos test indican que es más verosímil un resultado positivo en enfermos que en sanos.<br>
- rDLR+(A,B)= 1,78. El resultado positivo del test A es más informativo del riesgo de enfermedad que el positivo del test B.</p>
>>>>>>> origin/main
>>>>>>> origin/main


</section></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copiado");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copiado");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation column-body"><div class="nav-page nav-page-previous">
      <a href="../tema_02/tema_02_1_introduccion.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-title">1.1. Conceptos básicos <span style="color:green;">✓</span></span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../tema_02/tema_02_2_comparacion_test_y_tamanyos_muestrales.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-title">2. Comparación de test y tratamiento del tamaño mmuestral <span style="color:red;">✗</span></span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>